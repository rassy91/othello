!function(){const t=function(t){this.ctx=t,this.cautionText=document.getElementById("caution"),this.GRID_SIZE=50,this.LINE_NUMBER=9,this.R=.3*this.GRID_SIZE,this.color="#ffffff",this.isWhite=1,this.board=[],this.turnStones=[],this.init()};t.prototype={init:function(){const t=this;t.ctx.translate(1,1),t.drawBoard();for(let e=1;e<t.LINE_NUMBER;e++){let e=[];for(let i=1;i<t.LINE_NUMBER;i++)e.push({});t.board.push(e)}},drawBoard:function(){const t=this,e=t.GRID_SIZE*(t.LINE_NUMBER-1);let i=0,n=0;t.drawRect(i,n,e,e,"#008833");for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(i,0,i,e),i+=t.GRID_SIZE;for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(0,n,e,n),n+=t.GRID_SIZE},drawRect:function(t,e,i,n,o){this.ctx.fillStyle=void 0!==o?o:"#000000",this.ctx.fillRect(t,e,i,n)},drawLine:function(t,e,i,n,o,s){this.ctx.strokeStyle=void 0!==o?o:"#000000",this.ctx.lineWidth=void 0!==s?s:1,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.closePath(),this.ctx.stroke()},startGame:function(){const t=this,e=t.GRID_SIZE*((t.LINE_NUMBER-1)/2),i=t.GRID_SIZE/2;let n,o,s=-1,h=-1,c=1;function l(l){for(let r=0;r<2;r++){let l={r:t.R};n=e+s*i,o=e+h*i,l.x=n,l.y=o,l.isWhite=c;let r=new window.myOthello.Stone(t.ctx,l);r.drawArc(l);let a=t.board[Math.floor(o/t.GRID_SIZE)][Math.floor(n/t.GRID_SIZE)];a.instance=r,a.isWhite=c,s*=-1,h*=-1}}l(),s*=-1,c*=-1,l()},validate:function(){const t=this;t.cautionText.classList.contains("isVisible")||(t.cautionText.classList.add("isVisible"),setTimeout(function(){t.cautionText.classList.remove("isVisible")},1e3))},putStone:function(t,e){const i=this;let n=Math.floor(t/i.GRID_SIZE),o=Math.floor(e/i.GRID_SIZE);if(!i.checkVacancy(n,o))return void i.validate();if(!i.checkNeighbor(n,o))return void i.validate();if(!i.checkIfPossible(n,o))return void i.validate();i.isWhite*=-1,color=i.isWhite>0?"#ffffff":"#000000";let s={x:i.GRID_SIZE*n+i.GRID_SIZE/2,y:i.GRID_SIZE*o+i.GRID_SIZE/2,r:i.R,isWhite:i.isWhite},h=new window.myOthello.Stone(i.ctx,s);h.drawArc(s);let c=i.board[o][n];c.instance=h,c.isWhite=i.isWhite,i.turnStones.length>0&&(i.turnStones.forEach(function(t){t.isWhite*=-1,t.instance.reverse()}),i.turnStones.length=0),console.log(i.board)},checkVacancy:function(t,e){return Object.keys(this.board[e][t]).length<=0},checkNeighbor:function(t,e){const i=this;let n,o,s=[[t,e-1],[t+1,e-1],[t+1,e],[t+1,e+1],[t,e+1],[t-1,e+1],[t-1,e],[t-1,e-1]];for(let h=0,c=s.length;h<c;h++)if(o=s[h][1],n=s[h][0],!(o<0||o>7||n<0||n>7)&&Object.keys(i.board[o][n]).length>0)return!0},checkIfPossible:function(t,e){const i=this,n=i.LINE_NUMBER-1-1;let o=!1,s=!1,h=null,c=null,l=[];return function(){for(let r=1;r<n&&!(e-r<0);r++)if(h=i.board[e-r][t],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((c=i.board[e-n][t]).y=e-n,c.x=t,!(Object.keys(c).length>0&&c.isWhite===i.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,e=l.length;t<e;t++)i.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(e+r>7);r++)if(h=i.board[e+r][t],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((c=i.board[e+n][t]).y=e+n,c.x=t,!(Object.keys(c).length>0&&c.isWhite===i.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,e=l.length;t<e;t++)i.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(t-r<0);r++)if(h=i.board[e][t-r],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((c=i.board[e][t-n]).y=e,c.x=t-n,!(Object.keys(c).length>0&&c.isWhite===i.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,e=l.length;t<e;t++)i.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(t+r>7);r++)if(h=i.board[e][t+r],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((c=i.board[e][t+n]).y=e,c.x=t+n,!(Object.keys(c).length>0&&c.isWhite===i.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,e=l.length;t<e;t++)i.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),o}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.BoardManager=t}(),function(){const t=function(t,e){this.canvas=t,this.color=e.color,this.stones=[],this.init()};t.prototype={init:function(){this.setEvent()},setEvent:function(){},getClickPos:function(){}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Player=t}(),function(){const t=function(t,e){this.ctx=t,this.data=e,this.isWhite=e.isWhite};t.prototype={drawArc:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()},reverse:function(){this.isWhite*=-1,this.ctx.beginPath(),this.ctx.arc(this.data.x,this.data.y,this.data.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Stone=t}(),document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("canvas");if(!t.getContext)return;const e=document.getElementById("wrapper"),i=t.getContext("2d");i.canvas.width=e.clientWidth,i.canvas.height=e.clientHeight;const n=new myOthello.BoardManager(i);n.startGame(),t.addEventListener("click",function(t){n.putStone(t.offsetX,t.offsetY)})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJvYXJkTWFuYWdlci5qcyIsIlBsYXllci5qcyIsIlN0b25lLmpzIiwic2NyaXB0LmpzIl0sIm5hbWVzIjpbIkJvYXJkTWFuYWdlciIsImN0eCIsInRoaXMiLCJjYXV0aW9uVGV4dCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJHUklEX1NJWkUiLCJMSU5FX05VTUJFUiIsIlIiLCJjb2xvciIsImlzV2hpdGUiLCJib2FyZCIsInR1cm5TdG9uZXMiLCJpbml0IiwicHJvdG90eXBlIiwic2VsZiIsInRyYW5zbGF0ZSIsImRyYXdCb2FyZCIsImkiLCJyb3ciLCJqIiwicHVzaCIsImZpZWxkU2l6ZSIsIngiLCJ5IiwiZHJhd1JlY3QiLCJkcmF3TGluZSIsIngxIiwieTEiLCJ4MiIsInkyIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJ3aWR0aCIsInN0cm9rZVN0eWxlIiwibGluZVdpZHRoIiwiYmVnaW5QYXRoIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwic3RhcnRHYW1lIiwiY2VudGVyIiwiZGlmZiIsInBvc1giLCJwb3NZIiwiZGlyMSIsImRpcjIiLCJzZXRGaXJzdFN0b25lIiwiZGF0YSIsInIiLCJzdG9uZSIsIndpbmRvdyIsIm15T3RoZWxsbyIsIlN0b25lIiwiZHJhd0FyYyIsIm9iaiIsIk1hdGgiLCJmbG9vciIsImluc3RhbmNlIiwidmFsaWRhdGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZCIsInNldFRpbWVvdXQiLCJyZW1vdmUiLCJwdXRTdG9uZSIsImNsaWNrZWRYIiwiY2xpY2tlZFkiLCJudGhHcmlkWCIsIm50aEdyaWRZIiwiY2hlY2tWYWNhbmN5IiwiY2hlY2tOZWlnaGJvciIsImNoZWNrSWZQb3NzaWJsZSIsImxlbmd0aCIsImZvckVhY2giLCJ2YWwiLCJyZXZlcnNlIiwiY29uc29sZSIsImxvZyIsIm50aFgiLCJudGhZIiwiT2JqZWN0Iiwia2V5cyIsImxpbmUiLCJuZWlnaGJvcnMiLCJsZW4iLCJNQVhfQ09VTlQiLCJpc1Bvc3NpYmxlIiwiaXNUbXBQb3NzaWJsZSIsInRtcE9iaiIsInRtcFR1cm5TdG9uZXMiLCJjaGVja1RvcCIsImNoZWNrQm90dG9tIiwiY2hlY2tMZWZ0IiwiY2hlY2tSaWdodCIsIlBsYXllciIsImNhbnZhcyIsInN0b25lcyIsInNldEV2ZW50IiwiZ2V0Q2xpY2tQb3MiLCJhcmMiLCJQSSIsImZpbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0Q29udGV4dCIsIndyYXBwZXIiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsImUiLCJvZmZzZXRYIiwib2Zmc2V0WSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxNQUFBQSxFQUFBLFNBQUFDLEdBQ0FDLEtBRUFELElBQUFBLEVBRkFDLEtBR0FDLFlBQUFDLFNBQUFDLGVBQUEsV0FIQUgsS0FNQUksVUFBQSxHQU5BSixLQU9BSyxZQUFBLEVBUEFMLEtBUUFNLEVBQUEsR0FSQU4sS0FRQUksVUFSQUosS0FVQU8sTUFBQSxVQVZBUCxLQVdBUSxRQUFBLEVBWEFSLEtBYUFTLFNBYkFULEtBZUFVLGNBZkFWLEtBaUJBVyxRQUdBYixFQUFBYyxXQUtBRCxLQUFBLFdBQ0EsTUFBQUUsRUFBQWIsS0FHQWEsRUFBQWQsSUFBQWUsVUFBQSxFQUFBLEdBRUFELEVBQUFFLFlBRUEsSUFBQSxJQUFBQyxFQUFBLEVBQUFBLEVBQUFILEVBQUFSLFlBQUFXLElBQUEsQ0FDQSxJQUFBQyxLQUVBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBTCxFQUFBUixZQUFBYSxJQUNBRCxFQUFBRSxTQUdBTixFQUFBSixNQUFBVSxLQUFBRixLQUtBRixVQUFBLFdBQ0EsTUFBQUYsRUFBQWIsS0FFQW9CLEVBQUFQLEVBQUFULFdBQUFTLEVBQUFSLFlBQUEsR0FFQSxJQUFBZ0IsRUFBQSxFQUNBQyxFQUFBLEVBRUFULEVBQUFVLFNBQUFGLEVBQUFDLEVBQUFGLEVBQUFBLEVBQUEsV0FFQSxJQUFBLElBQUFKLEVBQUEsRUFBQUEsR0FBQUgs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RUFBQUMsUUFBQUQsRUFBQUUiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyhmdW5jdGlvbigpIHtcblxuICAgIGNvbnN0IEJvYXJkTWFuYWdlciA9IGZ1bmN0aW9uKGN0eCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmN0eCA9IGN0eDtcbiAgICAgICAgc2VsZi5jYXV0aW9uVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXV0aW9uJyk7XG5cblxuICAgICAgICBzZWxmLkdSSURfU0laRSA9IDUwO1xuICAgICAgICBzZWxmLkxJTkVfTlVNQkVSID0gOTtcbiAgICAgICAgc2VsZi5SID0gc2VsZi5HUklEX1NJWkUgKiAwLjM7XG5cbiAgICAgICAgc2VsZi5jb2xvciA9ICcjZmZmZmZmJztcbiAgICAgICAgc2VsZi5pc1doaXRlID0gMTtcblxuICAgICAgICBzZWxmLmJvYXJkID0gW107XG5cbiAgICAgICAgc2VsZi50dXJuU3RvbmVzID0gW107XG5cbiAgICAgICAgc2VsZi5pbml0KCk7XG4gICAgfTtcblxuICAgIEJvYXJkTWFuYWdlci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqL1xuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyB4PTAsIHk9MOOBp+WFiOOBruWkquOBleOBjOWNiuWIhuOBl+aPj+WGmeOBleOCjOOBquOBhOOBn+OCgeOAgeWfuua6lueCueOCkuOBmuOCieOBmVxuICAgICAgICAgICAgc2VsZi5jdHgudHJhbnNsYXRlKDEsIDEpO1xuXG4gICAgICAgICAgICBzZWxmLmRyYXdCb2FyZCgpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgc2VsZi5MSU5FX05VTUJFUjsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvdy5wdXNoKHt9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZWxmLmJvYXJkLnB1c2gocm93KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdCb2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgY29uc3QgZmllbGRTaXplID0gc2VsZi5HUklEX1NJWkUgKiAoc2VsZi5MSU5FX05VTUJFUiAtIDEpO1xuXG4gICAgICAgICAgICBsZXQgeCA9IDA7XG4gICAgICAgICAgICBsZXQgeSA9IDA7XG5cbiAgICAgICAgICAgIHNlbGYuZHJhd1JlY3QoeCwgeSwgZmllbGRTaXplLCBmaWVsZFNpemUsICcjMDA4ODMzJyk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlbGYuZHJhd0xpbmUoeCwgMCwgeCwgZmllbGRTaXplKTtcbiAgICAgICAgICAgICAgICB4ICs9IHNlbGYuR1JJRF9TSVpFO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gc2VsZi5MSU5FX05VTUJFUjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5kcmF3TGluZSgwLCB5LCBmaWVsZFNpemUsIHkpO1xuICAgICAgICAgICAgICAgIHkgKz0gc2VsZi5HUklEX1NJWkU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3UmVjdDogZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIGNvbG9yKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gdHlwZW9mIGNvbG9yICE9PSAndW5kZWZpbmVkJyA/IGNvbG9yIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFJlY3QoeDEsIHkxLCB4MiwgeTIpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhd0xpbmU6IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBjb2xvciwgd2lkdGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5zdHJva2VTdHlsZSA9IHR5cGVvZiBjb2xvciAhPT0gJ3VuZGVmaW5lZCcgPyBjb2xvciA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmxpbmVXaWR0aCA9IHR5cGVvZiB3aWR0aCAhPT0gJ3VuZGVmaW5lZCcgPyB3aWR0aCA6IDE7XG5cbiAgICAgICAgICAgIHNlbGYuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgc2VsZi5jdHgubW92ZVRvKHgxLCB5MSk7XG4gICAgICAgICAgICBzZWxmLmN0eC5saW5lVG8oeDIsIHkyKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5zdHJva2UoKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIHN0YXJ0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgY29uc3QgY2VudGVyID0gc2VsZi5HUklEX1NJWkUgKiAoKHNlbGYuTElORV9OVU1CRVIgLSAxKSAvIDIpO1xuICAgICAgICAgICAgY29uc3QgZGlmZiA9IChzZWxmLkdSSURfU0laRSAvIDIpO1xuICAgICAgICAgICAgbGV0IGRpcjEgPSAtMTtcbiAgICAgICAgICAgIGxldCBkaXIyID0gLTE7XG4gICAgICAgICAgICBsZXQgcG9zWCwgcG9zWTtcbiAgICAgICAgICAgIGxldCBpc1doaXRlID0gMTtcblxuICAgICAgICAgICAgc2V0Rmlyc3RTdG9uZSgpO1xuICAgICAgICAgICAgZGlyMSAqPSAtMTtcbiAgICAgICAgICAgIGlzV2hpdGUgKj0gLTE7XG4gICAgICAgICAgICBzZXRGaXJzdFN0b25lKCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEZpcnN0U3RvbmUoY29sb3IpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHI6IHNlbGYuUlxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHBvc1ggPSBjZW50ZXIgKyBkaXIxICogZGlmZjtcbiAgICAgICAgICAgICAgICAgICAgcG9zWSA9IGNlbnRlciArIGRpcjIgKiBkaWZmO1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEueCA9IHBvc1g7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEueSA9IHBvc1k7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNXaGl0ZSA9IGlzV2hpdGU7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0b25lID0gbmV3IHdpbmRvdy5teU90aGVsbG8uU3RvbmUoc2VsZi5jdHgsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBzdG9uZS5kcmF3QXJjKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBvYmogPSBzZWxmLmJvYXJkW01hdGguZmxvb3IocG9zWSAvIHNlbGYuR1JJRF9TSVpFKV1bTWF0aC5mbG9vcihwb3NYIC8gc2VsZi5HUklEX1NJWkUpXTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmluc3RhbmNlID0gc3RvbmU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5pc1doaXRlID0gaXNXaGl0ZTtcblxuICAgICAgICAgICAgICAgICAgICBkaXIxICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICBkaXIyICo9IC0xO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoIXNlbGYuY2F1dGlvblRleHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpc1Zpc2libGUnKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2F1dGlvblRleHQuY2xhc3NMaXN0LmFkZCgnaXNWaXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYXV0aW9uVGV4dC5jbGFzc0xpc3QucmVtb3ZlKCdpc1Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHB1dFN0b25lOiBmdW5jdGlvbihjbGlja2VkWCwgY2xpY2tlZFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBsZXQgbnRoR3JpZFggPSBNYXRoLmZsb29yKGNsaWNrZWRYIC8gc2VsZi5HUklEX1NJWkUpO1xuICAgICAgICAgICAgbGV0IG50aEdyaWRZID0gTWF0aC5mbG9vcihjbGlja2VkWSAvIHNlbGYuR1JJRF9TSVpFKTtcblxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrVmFjYW5jeShudGhHcmlkWCwgbnRoR3JpZFkpKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrTmVpZ2hib3IobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc2VsZi5jaGVja0lmUG9zc2libGUobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgY29sb3IgPSBzZWxmLmlzV2hpdGUgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB4OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWCkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICB5OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWSkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICByOiBzZWxmLlIsXG4gICAgICAgICAgICAgICAgaXNXaGl0ZTogc2VsZi5pc1doaXRlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgc3RvbmUgPSBuZXcgd2luZG93Lm15T3RoZWxsby5TdG9uZShzZWxmLmN0eCwgZGF0YSk7XG4gICAgICAgICAgICBzdG9uZS5kcmF3QXJjKGRhdGEpO1xuXG4gICAgICAgICAgICBsZXQgb2JqID0gc2VsZi5ib2FyZFtudGhHcmlkWV1bbnRoR3JpZFhdO1xuICAgICAgICAgICAgb2JqLmluc3RhbmNlID0gc3RvbmU7XG4gICAgICAgICAgICBvYmouaXNXaGl0ZSA9IHNlbGYuaXNXaGl0ZTtcblxuICAgICAgICAgICAgaWYgKHNlbGYudHVyblN0b25lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmZvckVhY2goZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbC5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB2YWwuaW5zdGFuY2UucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGYuYm9hcmQpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hlY2tWYWNhbmN5OiBmdW5jdGlvbihudGhYLCBudGhZKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHNlbGYuYm9hcmRbbnRoWV1bbnRoWF0pLmxlbmd0aCA8PSAwO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hlY2tOZWlnaGJvcjogZnVuY3Rpb24obnRoWCwgbnRoWSkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGxldCByb3csIGxpbmU7XG5cbiAgICAgICAgICAgIGxldCBuZWlnaGJvcnMgPSBbXG4gICAgICAgICAgICAgICAgW250aFgsIG50aFkgLSAxXSwgICAgICAgLy8g5LiKXG4gICAgICAgICAgICAgICAgW250aFggKyAxLCBudGhZIC0gMV0sICAgLy8g5Y+z5LiKXG4gICAgICAgICAgICAgICAgW250aFggKyAxLCBudGhZXSwgICAgICAgLy8g5Y+zXG4gICAgICAgICAgICAgICAgW250aFggKyAxLCBudGhZICsgMV0sICAgLy8g5Y+z5LiLXG4gICAgICAgICAgICAgICAgW250aFgsIG50aFkgKyAxXSwgICAgICAgLy8g5LiLXG4gICAgICAgICAgICAgICAgW250aFggLSAxLCBudGhZICsgMV0sICAgLy8g5bem5LiLXG4gICAgICAgICAgICAgICAgW250aFggLSAxLCBudGhZXSwgICAgICAgLy8g5bemXG4gICAgICAgICAgICAgICAgW250aFggLSAxLCBudGhZIC0gMV0gICAgLy8g5bem5LiKXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gbmVpZ2hib3JzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBsaW5lID0gbmVpZ2hib3JzW2ldWzFdO1xuICAgICAgICAgICAgICAgIHJvdyA9IG5laWdoYm9yc1tpXVswXTtcblxuICAgICAgICAgICAgICAgIGlmIChsaW5lIDwgMCB8fCBsaW5lID4gNyB8fCByb3cgPCAwIHx8IHJvdyA+IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHNlbGYuYm9hcmRbbGluZV1bcm93XSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja0lmUG9zc2libGU6IGZ1bmN0aW9uKG50aFgsIG50aFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGkgKyAnIC8gNCcpO1xuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKE1hdGguY29zKE1hdGguUEkgLyA0ICogaSksIE1hdGguc2luKE1hdGguUEkgLyA0ICogaSkpO1xuICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICBjb25zdCBNQVhfQ09VTlQgPSAoc2VsZi5MSU5FX05VTUJFUiAtIDEpIC0gMTsgLy8gKCjnt5rjga7mlbAtMSkgLSDoh6rouqvjgYznva7jgYvjgozjgovjg57jgrkpXG4gICAgICAgICAgICBsZXQgaXNQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBvYmogPSBudWxsO1xuICAgICAgICAgICAgbGV0IHRtcE9iaiA9IG51bGw7XG4gICAgICAgICAgICBsZXQgdG1wVHVyblN0b25lcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyDnva7jgZHjgovmnaHku7ZcbiAgICAgICAgICAgIC8vIOW3puWPs+OAgeS4iuS4i+OAgeaWnOOCgTQ15bqm5LiK44Gr5ZCM44GY6Imy44Gu55+z44GM44GC44KLXG4gICAgICAgICAgICAvLyDjgYvjgaQg44Gd44Gu5ZCM44GY6Imy44Gu55+z44Go6Ieq6Lqr44Gu6ZaT44Gr6ZqZ6ZaT44Gq44GP5Yil44Gu6Imy44Gu55+z44GM44GC44KLXG5cbiAgICAgICAgICAgIC8vIGxldCBuZWlnaGJvcnMgPSBbXG4gICAgICAgICAgICAvLyAgICAgW250aFgsIG50aFkgLSAxXSwgICAgICAgLy8g5LiKXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZIC0gMV0sICAgLy8g5Y+z5LiKXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZXSwgICAgICAgLy8g5Y+zXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZICsgMV0sICAgLy8g5Y+z5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFgsIG50aFkgKyAxXSwgICAgICAgLy8g5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZICsgMV0sICAgLy8g5bem5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZXSwgICAgICAgLy8g5bemXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZIC0gMV0gICAgLy8g5bem5LiKXG4gICAgICAgICAgICAvLyBdO1xuICAgICAgICAgICAgLy8g44Gn44Gd44KM44Ge44KM44OB44Kn44OD44Kv44GZ44KL77yfXG4gICAgICAgICAgICBjaGVja1RvcCgpO1xuICAgICAgICAgICAgY2hlY2tCb3R0b20oKTtcbiAgICAgICAgICAgIGNoZWNrTGVmdCgpO1xuICAgICAgICAgICAgY2hlY2tSaWdodCgpO1xuXG5cbiAgICAgICAgICAgIHJldHVybiBpc1Bvc3NpYmxlO1xuXG5cbiAgICAgICAgICAgIC8vIOS4iuOCkuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tUb3AoKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFkgLSBpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyDoh6rouqvjgYvjgonoqbLlvZPmlrnlkJHjga7kuK3jgafkuIDnlarov5HjgYTnn7NcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZIC0gaV1bbnRoWF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA+IDApICYmIChvYmouaXNXaGl0ZSAqIC0xID09PSBzZWxmLmlzV2hpdGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqID0gc2VsZi5ib2FyZFtudGhZIC0gal1bbnRoWF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnkgPSBudGhZIC0gajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueCA9IG50aFg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModG1wT2JqKS5sZW5ndGggPiAwICYmIHRtcE9iai5pc1doaXRlID09PSBzZWxmLmlzV2hpdGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVG1wUG9zc2libGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSB0bXBUdXJuU3RvbmVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcFR1cm5TdG9uZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIOS4i+OCkuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tCb3R0b20oKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFkgKyBpID4gNykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvYmogPSBzZWxmLmJvYXJkW250aFkgKyBpXVtudGhYXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID4gMCkgJiYgKG9iai5pc1doaXRlICogLTEgPT09IHNlbGYuaXNXaGl0ZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmogPSBzZWxmLmJvYXJkW250aFkgKyBqXVtudGhYXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueSA9IG50aFkgKyBqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai54ID0gbnRoWDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0bXBPYmopLmxlbmd0aCA+IDAgJiYgdG1wT2JqLmlzV2hpdGUgPT09IHNlbGYuaXNXaGl0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLnB1c2godG1wT2JqKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUbXBQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUbXBQb3NzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IHRtcFR1cm5TdG9uZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLnB1c2godG1wVHVyblN0b25lc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Bvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAvLyDlt6bjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrTGVmdCgpIHtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgTUFYX0NPVU5UOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobnRoWCAtIGkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIOiHqui6q+OBi+OCieipsuW9k+aWueWQkeOBruS4reOBp+S4gOeVqui/keOBhOefs1xuICAgICAgICAgICAgICAgICAgICBvYmogPSBzZWxmLmJvYXJkW250aFldW250aFggLSBpXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID4gMCkgJiYgKG9iai5pc1doaXRlICogLTEgPT09IHNlbGYuaXNXaGl0ZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmogPSBzZWxmLmJvYXJkW250aFldW250aFggLSBqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueSA9IG50aFk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnggPSBudGhYIC0gajtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0bXBPYmopLmxlbmd0aCA+IDAgJiYgdG1wT2JqLmlzV2hpdGUgPT09IHNlbGYuaXNXaGl0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLnB1c2godG1wT2JqKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUbXBQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUbXBQb3NzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IHRtcFR1cm5TdG9uZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLnB1c2godG1wVHVyblN0b25lc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Bvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIOWPs+OCkuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tSaWdodCgpIHtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgTUFYX0NPVU5UOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobnRoWCArIGkgPiA3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIOiHqui6q+OBi+OCieipsuW9k+aWueWQkeOBruS4reOBp+S4gOeVqui/keOBhOefs1xuICAgICAgICAgICAgICAgICAgICBvYmogPSBzZWxmLmJvYXJkW250aFldW250aFggKyBpXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID4gMCkgJiYgKG9iai5pc1doaXRlICogLTEgPT09IHNlbGYuaXNXaGl0ZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmogPSBzZWxmLmJvYXJkW250aFldW250aFggKyBqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueSA9IG50aFk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnggPSBudGhYICsgajtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0bXBPYmopLmxlbmd0aCA+IDAgJiYgdG1wT2JqLmlzV2hpdGUgPT09IHNlbGYuaXNXaGl0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLnB1c2godG1wT2JqKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUbXBQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUbXBQb3NzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IHRtcFR1cm5TdG9uZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLnB1c2godG1wVHVyblN0b25lc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Bvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuXG5cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uQm9hcmRNYW5hZ2VyID0gQm9hcmRNYW5hZ2VyO1xuXG59KCkpOyIsIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBQbGF5ZXIgPSBmdW5jdGlvbihjYW52YXMsIGRhdGEpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5jYW52YXMgPSBjYW52YXM7XG5cbiAgICAgICAgc2VsZi5jb2xvciA9IGRhdGEuY29sb3I7XG4gICAgICAgIHNlbGYuc3RvbmVzID0gW107XG5cbiAgICAgICAgc2VsZi5pbml0KCk7XG4gICAgfTtcblxuICAgIFBsYXllci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5zZXRFdmVudCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBzZWxmLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhlLm9mZnNldFgpO1xuICAgICAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDbGlja1BvczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdy5teU90aGVsbG8gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy5teU90aGVsbG8gPSB7fTtcbiAgICB9XG4gICAgd2luZG93Lm15T3RoZWxsby5QbGF5ZXIgPSBQbGF5ZXI7XG5cbn0oKSk7IiwiOyhmdW5jdGlvbigpIHtcblxuICAgIGNvbnN0IFN0b25lID0gZnVuY3Rpb24oY3R4LCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuY3R4ID0gY3R4O1xuICAgICAgICBzZWxmLmRhdGEgPSBkYXRhO1xuICAgICAgICBzZWxmLmlzV2hpdGUgPSBkYXRhLmlzV2hpdGU7XG5cbiAgICB9O1xuXG4gICAgU3RvbmUucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGRyYXdBcmM6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmFyYyhkYXRhLngsIGRhdGEueSwgZGF0YS5yLCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7XG4gICAgICAgICAgICBzZWxmLmN0eC5maWxsU3R5bGUgPSBzZWxmLmlzV2hpdGUgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbCgpO1xuICAgICAgICAgICAgc2VsZi5jdHguY2xvc2VQYXRoKCk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICByZXZlcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBzZWxmLmlzV2hpdGUgKj0gLTE7XG5cbiAgICAgICAgICAgIHNlbGYuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgc2VsZi5jdHguYXJjKHNlbGYuZGF0YS54LCBzZWxmLmRhdGEueSwgc2VsZi5kYXRhLnIsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGxTdHlsZSA9IHNlbGYuaXNXaGl0ZSA+IDAgPyAnI2ZmZmZmZicgOiAnIzAwMDAwMCc7XG4gICAgICAgICAgICBzZWxmLmN0eC5maWxsKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdy5teU90aGVsbG8gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy5teU90aGVsbG8gPSB7fTtcbiAgICB9XG4gICAgd2luZG93Lm15T3RoZWxsby5TdG9uZSA9IFN0b25lO1xuXG59KCkpOyIsIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuXG4gICAgICAgIGlmICghY2FudmFzLmdldENvbnRleHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JhcHBlcicpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgY3R4LmNhbnZhcy53aWR0aCA9IHdyYXBwZXIuY2xpZW50V2lkdGg7XG4gICAgICAgIGN0eC5jYW52YXMuaGVpZ2h0ID0gd3JhcHBlci5jbGllbnRIZWlnaHQ7XG5cbiAgICAgICAgbGV0IHBsYXllckRhdGEgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2U6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ3doaXRlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2U6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2JsYWNrJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBib2FyZCA9IG5ldyBteU90aGVsbG8uQm9hcmRNYW5hZ2VyKGN0eCk7XG5cbiAgICAgICAgYm9hcmQuc3RhcnRHYW1lKCk7XG5cbiAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICBib2FyZC5wdXRTdG9uZShlLm9mZnNldFgsIGUub2Zmc2V0WSk7XG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgLy8g44OV44Kj44O844Or44OJ44KS5pu444GP77yIOHg477yJXG4gICAgICAgIC8vIOWQhOODnuOCueebruOBruOCqOODquOCouaDheWgseOCkuS/neaMge+8iHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZ77yJXG4gICAgICAgIC8vICAgICAg44Kv44Oq44OD44Kv44GX44Gf5L2N572u44GoY2FudmFz5LiK44Gu5L2N572u44Gu5aSJ5o+b44GM5b+F6KaB77yfXG4gICAgICAgIC8vIOODl+ODrOOCpOODpOODvOeZveODu+m7kuOCkuOCu+ODg+ODiFxuICAgICAgICAvLyAgICAgIOODleODqeOCsOOBq+OBmeOCi++8n1xuICAgICAgICAvLyDkuK3lpK7jgavnmb3pu5Iy44GT44Ga44Gk44K744OD44OIXG5cbiAgICAgICAgLy8g5ZCE44OX44Os44Kk44Ok44O844Gu572u44GE44Gf55+z44KS5L+d5oyB44GZ44KL6YWN5YiXXG4gICAgICAgIC8vXG5cblxuXG4gICAgfSk7XG5cbn0oKSk7XG5cbi8qKlxuICogLy8gVE9ETyDos6rllY9cbiAqXG4gKiAxLlxuIOOAjOWIpOWumuOBmeOCi+OAjeOBqOOBhOOBhuiLseiqnuOBr+S9leOCkuS9v+OBo+OBpuOBvuOBmeOBi++8n1xuXG4gZmluZD8ganVkZ2U/IGRlY2lkZT9cblxuXG4gMi5cbiBjaHJvbWXjga5kZXbjg4Tjg7zjg6vjgafjgqTjg7Pjgrnjgr/jg7PjgrnjgavlhaXjgaPjgabjgYTjgot044Go44Gv44Gq44KT44Gu5oSP5ZGz44CB55Wl77yI77yf77yJ44Gn44GZ44GL77yf44Kk44Oz44K544K/44Oz44K544KS44Ot44Kw44Gr5Ye644GZ44GodOOBqOOBquOCi++8n1xuIGJvYXJkLnN0YXJ0R2FtZeOBruacgOW+jOOBp2NvbnNvbGUubG9nKHNlbGYuc3RvbmVQb3Nlcyk744GZ44KL44Go56K66KqN44Gn44GN44KLXG5cbiAqL1xuIl19