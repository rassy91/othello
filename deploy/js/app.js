!function(){const t=function(t){this.ctx=t,this.GRID_SIZE=50,this.LINE_NUMBER=9,this.R=.3*this.GRID_SIZE,this.color="#ffffff",this.isWhite=1,this.board=[],this.turnStones=[],this.init()};t.prototype={init:function(){const t=this;t.ctx.translate(1,1),t.drawBoard();for(let i=1;i<t.LINE_NUMBER;i++){let i=[];for(let e=1;e<t.LINE_NUMBER;e++)i.push({});t.board.push(i)}},drawBoard:function(){const t=this,i=t.GRID_SIZE*(t.LINE_NUMBER-1);let e=0,n=0;t.drawRect(e,n,i,i,"#008833");for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(e,0,e,i),e+=t.GRID_SIZE;for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(0,n,i,n),n+=t.GRID_SIZE},drawRect:function(t,i,e,n,o){this.ctx.fillStyle=void 0!==o?o:"#000000",this.ctx.fillRect(t,i,e,n)},drawLine:function(t,i,e,n,o,s){this.ctx.strokeStyle=void 0!==o?o:"#000000",this.ctx.lineWidth=void 0!==s?s:1,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,n),this.ctx.closePath(),this.ctx.stroke()},startGame:function(){const t=this,i=t.GRID_SIZE*((t.LINE_NUMBER-1)/2),e=t.GRID_SIZE/2;let n,o,s=-1,h=-1,c=1;function l(l){for(let r=0;r<2;r++){let l={r:t.R};n=i+s*e,o=i+h*e,l.x=n,l.y=o,l.isWhite=c;let r=new window.myOthello.Stone(t.ctx,l);r.drawArc(l);let f=t.board[Math.floor(o/t.GRID_SIZE)][Math.floor(n/t.GRID_SIZE)];f.instance=r,f.isWhite=c,s*=-1,h*=-1}}l(),s*=-1,c*=-1,l()},putStone:function(t,i){const e=this;let n=Math.floor(t/e.GRID_SIZE),o=Math.floor(i/e.GRID_SIZE);if(!e.checkVacancy(n,o))return;if(!e.checkNeighbor(n,o))return;if(!e.checkIfPossible(n,o))return;e.isWhite*=-1,color=e.isWhite>0?"#ffffff":"#000000";let s={x:e.GRID_SIZE*n+e.GRID_SIZE/2,y:e.GRID_SIZE*o+e.GRID_SIZE/2,r:e.R,isWhite:e.isWhite},h=new window.myOthello.Stone(e.ctx,s);h.drawArc(s);let c=e.board[o][n];c.instance=h,c.isWhite=e.isWhite,e.turnStones.length>0&&(e.turnStones.forEach(function(t){t.isWhite*=-1,t.instance.reverse()}),e.turnStones.length=0)},checkVacancy:function(t,i){return Object.keys(this.board[i][t]).length<=0},checkNeighbor:function(t,i){const e=this;let n,o,s=[[t,i-1],[t+1,i-1],[t+1,i],[t+1,i+1],[t,i+1],[t-1,i+1],[t-1,i],[t-1,i-1]];for(let h=0,c=s.length;h<c;h++)if(o=s[h][1],n=s[h][0],!(o<0||o>7||n<0||n>7)&&Object.keys(e.board[o][n]).length>0)return!0},checkIfPossible:function(t,i){const e=this,n=e.LINE_NUMBER-1-1;let o=!1,s=null,h=null;return function(){for(let c=1;c<n&&!(i-c<0);c++)if(s=e.board[i-c][t],Object.keys(s).length>0&&-1*s.isWhite===e.isWhite){for(let n=1;n<c;n++){if((h=e.board[i-n][t]).y=i-n,h.x=t,!(Object.keys(h).length>0&&h.isWhite===e.isWhite)){o=!1,e.turnStones.length=0;break}o=!0,e.turnStones.push(h)}if(o)break}}(),o}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.BoardManager=t}(),function(){const t=function(t,i){this.canvas=t,this.color=i.color,this.stones=[],this.init()};t.prototype={init:function(){this.setEvent()},setEvent:function(){},getClickPos:function(){}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Player=t}(),function(){const t=function(t,i){this.ctx=t,this.data=i,this.isWhite=i.isWhite};t.prototype={drawArc:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()},reverse:function(){this.ctx.beginPath(),this.ctx.arc(this.data.x,this.data.y,this.data.r,0,2*Math.PI,!0),this.ctx.fillStyle=-1*this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Stone=t}(),document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("canvas");if(!t.getContext)return;const i=document.getElementById("wrapper"),e=t.getContext("2d");e.canvas.width=i.clientWidth,e.canvas.height=i.clientHeight;const n=new myOthello.BoardManager(e);n.startGame(),t.addEventListener("click",function(t){n.putStone(t.offsetX,t.offsetY)})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJvYXJkTWFuYWdlci5qcyIsIlBsYXllci5qcyIsIlN0b25lLmpzIiwic2NyaXB0LmpzIl0sIm5hbWVzIjpbIkJvYXJkTWFuYWdlciIsImN0eCIsInRoaXMiLCJHUklEX1NJWkUiLCJMSU5FX05VTUJFUiIsIlIiLCJjb2xvciIsImlzV2hpdGUiLCJib2FyZCIsInR1cm5TdG9uZXMiLCJpbml0IiwicHJvdG90eXBlIiwic2VsZiIsInRyYW5zbGF0ZSIsImRyYXdCb2FyZCIsImkiLCJyb3ciLCJqIiwicHVzaCIsImZpZWxkU2l6ZSIsIngiLCJ5IiwiZHJhd1JlY3QiLCJkcmF3TGluZSIsIngxIiwieTEiLCJ4MiIsInkyIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJ3aWR0aCIsInN0cm9rZVN0eWxlIiwibGluZVdpZHRoIiwiYmVnaW5QYXRoIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwic3RhcnRHYW1lIiwiY2VudGVyIiwiZGlmZiIsInBvc1giLCJwb3NZIiwiZGlyMSIsImRpcjIiLCJzZXRGaXJzdFN0b25lIiwiZGF0YSIsInIiLCJzdG9uZSIsIndpbmRvdyIsIm15T3RoZWxsbyIsIlN0b25lIiwiZHJhd0FyYyIsIm9iaiIsIk1hdGgiLCJmbG9vciIsImluc3RhbmNlIiwicHV0U3RvbmUiLCJjbGlja2VkWCIsImNsaWNrZWRZIiwibnRoR3JpZFgiLCJudGhHcmlkWSIsImNoZWNrVmFjYW5jeSIsImNoZWNrTmVpZ2hib3IiLCJjaGVja0lmUG9zc2libGUiLCJsZW5ndGgiLCJmb3JFYWNoIiwidmFsIiwicmV2ZXJzZSIsIm50aFgiLCJudGhZIiwiT2JqZWN0Iiwia2V5cyIsImxpbmUiLCJuZWlnaGJvcnMiLCJsZW4iLCJNQVhfQ09VTlQiLCJpc1Bvc3NpYmxlIiwidG1wT2JqIiwiY2hlY2tUb3AiLCJQbGF5ZXIiLCJjYW52YXMiLCJzdG9uZXMiLCJzZXRFdmVudCIsImdldENsaWNrUG9zIiwiYXJjIiwiUEkiLCJmaWxsIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwid3JhcHBlciIsImNsaWVudFdpZHRoIiwiaGVpZ2h0IiwiY2xpZW50SGVpZ2h0IiwiZSIsIm9mZnNldFgiLCJvZmZzZXRZIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLE1BQUFBLEVBQUEsU0FBQUMsR0FDQUMsS0FFQUQsSUFBQUEsRUFGQUMsS0FJQUMsVUFBQSxHQUpBRCxLQUtBRSxZQUFBLEVBTEFGLEtBTUFHLEVBQUEsR0FOQUgsS0FNQUMsVUFOQUQsS0FRQUksTUFBQSxVQVJBSixLQVNBSyxRQUFBLEVBVEFMLEtBV0FNLFNBWEFOLEtBYUFPLGNBYkFQLEtBZUFRLFFBR0FWLEVBQUFXLFdBS0FELEtBQUEsV0FDQSxNQUFBRSxFQUFBVixLQUdBVSxFQUFBWCxJQUFBWSxVQUFBLEVBQUEsR0FFQUQsRUFBQUUsWUFFQSxJQUFBLElBQUFDLEVBQUEsRUFBQUEsRUFBQUgsRUFBQVIsWUFBQVcsSUFBQSxDQUNBLElBQUFDLEtBRUEsSUFBQSxJQUFBQyxFQUFBLEVBQUFBLEVBQUFMLEVBQUFSLFlBQUFhLElBQ0FELEVBQUFFLFNBR0FOLEVBQUFKLE1BQUFVLEtBQUFGLEtBS0FGLFVBQUEsV0FDQSxNQUFBRixFQUFBVixLQUVBaUIsRUFBQVAsRUFBQVQsV0FBQVMsRUFBQVIsWUFBQSxHQUVBLElBQUFnQixFQUFBLEVBQ0FDLEVBQUEsRUFFQVQsRUFBQVUsU0FBQUYsRUFBQUMsRUFBQUYsRUFBQUEsRUFBQSxXQUVBLElBQUEsSUFBQUosRUFBQSxFQUFBQSxHQUFBSCxFQUFBUixZQUFBVyxJQUNBSCxFQUFBVyxTQUFBSCxFQUFBLEVBQUFBLEVBQUFELEdBQ0FDLEdBQUFSLEVBQUFULFVBRUEsSUFBQSxJQUFBWSxFQUFBLEVBQUFBLEdBQUFILEVBQUFSLFlBQUFXLElBQ0FILEVBQUFXLFNBQUEsRUFBQUYsRUFBQUYsRUFBQUUsR0FDQUEsR0FBQVQsRUFBQVQsV0FLQW1CLFNBQUEsU0FBQUUsRUFBQUMsRUFBQUMs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T0FMQXJGLEtBTUFELElBQUFtQyxtQkFJQSxJQUFBYSxPQUFBQyxZQUNBRCxPQUFBQyxjQUVBRCxPQUFBQyxVQUFBQyxNQUFBQSxFQXRDQSxHQ0VBcUMsU0FBQUMsaUJBQUEsbUJBQUEsV0FFQSxNQUFBUixFQUFBTyxTQUFBRSxlQUFBLFVBRUEsSUFBQVQsRUFBQVUsV0FDQSxPQUdBLE1BQUFDLEVBQUFKLFNBQUFFLGVBQUEsV0FDQXpGLEVBQUFnRixFQUFBVSxXQUFBLE1BQ0ExRixFQUFBZ0YsT0FBQW5ELE1BQUE4RCxFQUFBQyxZQUNBNUYsRUFBQWdGLE9BQUFhLE9BQUFGLEVBQUFHLGFBaUJBLE1BQUF2RixFQUFBLElBQUEwQyxVQUFBbEQsYUFBQUMsR0FFQU8sRUFBQThCLFlBRUEyQyxFQUFBUSxpQkFBQSxRQUFBLFNBQUFPLEdBRUF4RixFQUFBaUQsU0FBQXVDLEVBQUFDLFFBQUFELEVBQUFFIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBCb2FyZE1hbmFnZXIgPSBmdW5jdGlvbihjdHgpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5jdHggPSBjdHg7XG5cbiAgICAgICAgc2VsZi5HUklEX1NJWkUgPSA1MDtcbiAgICAgICAgc2VsZi5MSU5FX05VTUJFUiA9IDk7XG4gICAgICAgIHNlbGYuUiA9IHNlbGYuR1JJRF9TSVpFICogMC4zO1xuXG4gICAgICAgIHNlbGYuY29sb3IgPSAnI2ZmZmZmZic7XG4gICAgICAgIHNlbGYuaXNXaGl0ZSA9IDE7XG5cbiAgICAgICAgc2VsZi5ib2FyZCA9IFtdO1xuXG4gICAgICAgIHNlbGYudHVyblN0b25lcyA9IFtdO1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH07XG5cbiAgICBCb2FyZE1hbmFnZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8geD0wLCB5PTDjgaflhYjjga7lpKrjgZXjgYzljYrliIbjgZfmj4/lhpnjgZXjgozjgarjgYTjgZ/jgoHjgIHln7rmupbngrnjgpLjgZrjgonjgZlcbiAgICAgICAgICAgIHNlbGYuY3R4LnRyYW5zbGF0ZSgxLCAxKTtcblxuICAgICAgICAgICAgc2VsZi5kcmF3Qm9hcmQoKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWxmLkxJTkVfTlVNQkVSOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgcm93ID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IHNlbGYuTElORV9OVU1CRVI7IGorKykge1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaCh7fSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5ib2FyZC5wdXNoKHJvdyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3Qm9hcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpZWxkU2l6ZSA9IHNlbGYuR1JJRF9TSVpFICogKHNlbGYuTElORV9OVU1CRVIgLSAxKTtcblxuICAgICAgICAgICAgbGV0IHggPSAwO1xuICAgICAgICAgICAgbGV0IHkgPSAwO1xuXG4gICAgICAgICAgICBzZWxmLmRyYXdSZWN0KHgsIHksIGZpZWxkU2l6ZSwgZmllbGRTaXplLCAnIzAwODgzMycpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzZWxmLkxJTkVfTlVNQkVSOyBpKyspIHtcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdMaW5lKHgsIDAsIHgsIGZpZWxkU2l6ZSk7XG4gICAgICAgICAgICAgICAgeCArPSBzZWxmLkdSSURfU0laRTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlbGYuZHJhd0xpbmUoMCwgeSwgZmllbGRTaXplLCB5KTtcbiAgICAgICAgICAgICAgICB5ICs9IHNlbGYuR1JJRF9TSVpFO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhd1JlY3Q6IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBjb2xvcikge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGxTdHlsZSA9IHR5cGVvZiBjb2xvciAhPT0gJ3VuZGVmaW5lZCcgPyBjb2xvciA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGxSZWN0KHgxLCB5MSwgeDIsIHkyKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdMaW5lOiBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgY29sb3IsIHdpZHRoKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguc3Ryb2tlU3R5bGUgPSB0eXBlb2YgY29sb3IgIT09ICd1bmRlZmluZWQnID8gY29sb3IgOiAnIzAwMDAwMCc7XG4gICAgICAgICAgICBzZWxmLmN0eC5saW5lV2lkdGggPSB0eXBlb2Ygd2lkdGggIT09ICd1bmRlZmluZWQnID8gd2lkdGggOiAxO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4Lm1vdmVUbyh4MSwgeTEpO1xuICAgICAgICAgICAgc2VsZi5jdHgubGluZVRvKHgyLCB5Mik7XG4gICAgICAgICAgICBzZWxmLmN0eC5jbG9zZVBhdGgoKTtcblxuICAgICAgICAgICAgc2VsZi5jdHguc3Ryb2tlKCk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IHNlbGYuR1JJRF9TSVpFICogKChzZWxmLkxJTkVfTlVNQkVSIC0gMSkgLyAyKTtcbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSAoc2VsZi5HUklEX1NJWkUgLyAyKTtcbiAgICAgICAgICAgIGxldCBkaXIxID0gLTE7XG4gICAgICAgICAgICBsZXQgZGlyMiA9IC0xO1xuICAgICAgICAgICAgbGV0IHBvc1gsIHBvc1k7XG4gICAgICAgICAgICBsZXQgaXNXaGl0ZSA9IDE7XG5cbiAgICAgICAgICAgIHNldEZpcnN0U3RvbmUoKTtcbiAgICAgICAgICAgIGRpcjEgKj0gLTE7XG4gICAgICAgICAgICBpc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgc2V0Rmlyc3RTdG9uZSgpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRGaXJzdFN0b25lKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByOiBzZWxmLlJcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBwb3NYID0gY2VudGVyICsgZGlyMSAqIGRpZmY7XG4gICAgICAgICAgICAgICAgICAgIHBvc1kgPSBjZW50ZXIgKyBkaXIyICogZGlmZjtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnggPSBwb3NYO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnkgPSBwb3NZO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzV2hpdGUgPSBpc1doaXRlO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdG9uZSA9IG5ldyB3aW5kb3cubXlPdGhlbGxvLlN0b25lKHNlbGYuY3R4LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgc3RvbmUuZHJhd0FyYyhkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gc2VsZi5ib2FyZFtNYXRoLmZsb29yKHBvc1kgLyBzZWxmLkdSSURfU0laRSldW01hdGguZmxvb3IocG9zWCAvIHNlbGYuR1JJRF9TSVpFKV07XG4gICAgICAgICAgICAgICAgICAgIG9iai5pbnN0YW5jZSA9IHN0b25lO1xuICAgICAgICAgICAgICAgICAgICBvYmouaXNXaGl0ZSA9IGlzV2hpdGU7XG5cbiAgICAgICAgICAgICAgICAgICAgZGlyMSAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgZGlyMiAqPSAtMTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuXG4gICAgICAgIHB1dFN0b25lOiBmdW5jdGlvbihjbGlja2VkWCwgY2xpY2tlZFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBsZXQgbnRoR3JpZFggPSBNYXRoLmZsb29yKGNsaWNrZWRYIC8gc2VsZi5HUklEX1NJWkUpO1xuICAgICAgICAgICAgbGV0IG50aEdyaWRZID0gTWF0aC5mbG9vcihjbGlja2VkWSAvIHNlbGYuR1JJRF9TSVpFKTtcblxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrVmFjYW5jeShudGhHcmlkWCwgbnRoR3JpZFkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrTmVpZ2hib3IobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc2VsZi5jaGVja0lmUG9zc2libGUobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgY29sb3IgPSBzZWxmLmlzV2hpdGUgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB4OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWCkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICB5OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWSkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICByOiBzZWxmLlIsXG4gICAgICAgICAgICAgICAgaXNXaGl0ZTogc2VsZi5pc1doaXRlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgc3RvbmUgPSBuZXcgd2luZG93Lm15T3RoZWxsby5TdG9uZShzZWxmLmN0eCwgZGF0YSk7XG4gICAgICAgICAgICBzdG9uZS5kcmF3QXJjKGRhdGEpO1xuXG4gICAgICAgICAgICBsZXQgb2JqID0gc2VsZi5ib2FyZFtudGhHcmlkWV1bbnRoR3JpZFhdO1xuICAgICAgICAgICAgb2JqLmluc3RhbmNlID0gc3RvbmU7XG4gICAgICAgICAgICBvYmouaXNXaGl0ZSA9IHNlbGYuaXNXaGl0ZTtcblxuICAgICAgICAgICAgaWYgKHNlbGYudHVyblN0b25lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmZvckVhY2goZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbC5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB2YWwuaW5zdGFuY2UucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja1ZhY2FuY3k6IGZ1bmN0aW9uKG50aFgsIG50aFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoc2VsZi5ib2FyZFtudGhZXVtudGhYXSkubGVuZ3RoIDw9IDA7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja05laWdoYm9yOiBmdW5jdGlvbihudGhYLCBudGhZKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgbGV0IHJvdywgbGluZTtcblxuICAgICAgICAgICAgbGV0IG5laWdoYm9ycyA9IFtcbiAgICAgICAgICAgICAgICBbbnRoWCwgbnRoWSAtIDFdLCAgICAgICAvLyDkuIpcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFkgLSAxXSwgICAvLyDlj7PkuIpcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFldLCAgICAgICAvLyDlj7NcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFkgKyAxXSwgICAvLyDlj7PkuItcbiAgICAgICAgICAgICAgICBbbnRoWCwgbnRoWSArIDFdLCAgICAgICAvLyDkuItcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFkgKyAxXSwgICAvLyDlt6bkuItcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFldLCAgICAgICAvLyDlt6ZcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFkgLSAxXSAgICAvLyDlt6bkuIpcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBuZWlnaGJvcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIGxpbmUgPSBuZWlnaGJvcnNbaV1bMV07XG4gICAgICAgICAgICAgICAgcm93ID0gbmVpZ2hib3JzW2ldWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGxpbmUgPCAwIHx8IGxpbmUgPiA3IHx8IHJvdyA8IDAgfHwgcm93ID4gNykge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoc2VsZi5ib2FyZFtsaW5lXVtyb3ddKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrSWZQb3NzaWJsZTogZnVuY3Rpb24obnRoWCwgbnRoWSkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coaSArICcgLyA0Jyk7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coTWF0aC5jb3MoTWF0aC5QSSAvIDQgKiBpKSwgTWF0aC5zaW4oTWF0aC5QSSAvIDQgKiBpKSk7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIGNvbnN0IE1BWF9DT1VOVCA9IChzZWxmLkxJTkVfTlVNQkVSIC0gMSkgLSAxOyAvLyAoKOe3muOBruaVsC0xKSAtIOiHqui6q+OBjOe9ruOBi+OCjOOCi+ODnuOCuSlcbiAgICAgICAgICAgIGxldCBpc1Bvc3NpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgb2JqID0gbnVsbDtcbiAgICAgICAgICAgIGxldCB0bXBPYmogPSBudWxsO1xuXG4gICAgICAgICAgICAvLyDnva7jgZHjgovmnaHku7ZcbiAgICAgICAgICAgIC8vIOW3puWPs+OAgeS4iuS4i+OAgeaWnOOCgTQ15bqm5LiK44Gr5ZCM44GY6Imy44Gu55+z44GM44GC44KLXG4gICAgICAgICAgICAvLyDjgYvjgaQg44Gd44Gu5ZCM44GY6Imy44Gu55+z44Go6Ieq6Lqr44Gu6ZaT44Gr6ZqZ6ZaT44Gq44GP5Yil44Gu6Imy44Gu55+z44GM44GC44KLXG5cbiAgICAgICAgICAgIC8vIGxldCBuZWlnaGJvcnMgPSBbXG4gICAgICAgICAgICAvLyAgICAgW250aFgsIG50aFkgLSAxXSwgICAgICAgLy8g5LiKXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZIC0gMV0sICAgLy8g5Y+z5LiKXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZXSwgICAgICAgLy8g5Y+zXG4gICAgICAgICAgICAvLyAgICAgW250aFggKyAxLCBudGhZICsgMV0sICAgLy8g5Y+z5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFgsIG50aFkgKyAxXSwgICAgICAgLy8g5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZICsgMV0sICAgLy8g5bem5LiLXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZXSwgICAgICAgLy8g5bemXG4gICAgICAgICAgICAvLyAgICAgW250aFggLSAxLCBudGhZIC0gMV0gICAgLy8g5bem5LiKXG4gICAgICAgICAgICAvLyBdO1xuICAgICAgICAgICAgLy8g44Gn44Gd44KM44Ge44KM44OB44Kn44OD44Kv44GZ44KL77yfXG4gICAgICAgICAgICBjaGVja1RvcCgpO1xuICAgICAgICAgICAgLy8gY2hlY2tCb3R0b20oKTtcblxuXG4gICAgICAgICAgICByZXR1cm4gaXNQb3NzaWJsZTtcblxuXG4gICAgICAgICAgICAvLyDkuIrjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrVG9wKCkge1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBNQVhfQ09VTlQ7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChudGhZIC0gaSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8g6Ieq6Lqr44GL44KJ6Kmy5b2T5pa55ZCR44Gu5Lit44Gn5LiA55Wq6L+R44GE55+zXG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IHNlbGYuYm9hcmRbbnRoWSAtIGldW250aFhdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPiAwKSAmJiAob2JqLmlzV2hpdGUgKiAtMSA9PT0gc2VsZi5pc1doaXRlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IGk7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iaiA9IHNlbGYuYm9hcmRbbnRoWSAtIGpdW250aFhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai55ID0gbnRoWSAtIGo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnggPSBudGhYO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRtcE9iaikubGVuZ3RoID4gMCAmJiB0bXBPYmouaXNXaGl0ZSA9PT0gc2VsZi5pc1doaXRlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNQb3NzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyDkuIvjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uIGNoZWNrQm90dG9tKCkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgICAgICBpZiAobnRoWSArIGkgPiA3KSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZICsgaV1bbnRoWF07XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgICAgICBpZiAoKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID4gMCkgJiYgKG9iai5pc1doaXRlICogLTEgPT09IHNlbGYuaXNXaGl0ZSkpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfkuIsnKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKG9iaik7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhpKTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBpc1Bvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy8gICAgICAgICB9XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIH1cblxuXG5cblxuXG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93Lm15T3RoZWxsbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgd2luZG93Lm15T3RoZWxsbyA9IHt9O1xuICAgIH1cbiAgICB3aW5kb3cubXlPdGhlbGxvLkJvYXJkTWFuYWdlciA9IEJvYXJkTWFuYWdlcjtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgUGxheWVyID0gZnVuY3Rpb24oY2FudmFzLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuY2FudmFzID0gY2FudmFzO1xuXG4gICAgICAgIHNlbGYuY29sb3IgPSBkYXRhLmNvbG9yO1xuICAgICAgICBzZWxmLnN0b25lcyA9IFtdO1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH07XG5cbiAgICBQbGF5ZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHNlbGYuc2V0RXZlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gc2VsZi5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coZS5vZmZzZXRYKTtcbiAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Q2xpY2tQb3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uUGxheWVyID0gUGxheWVyO1xuXG59KCkpOyIsIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBTdG9uZSA9IGZ1bmN0aW9uKGN0eCwgZGF0YSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmN0eCA9IGN0eDtcbiAgICAgICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICAgICAgc2VsZi5pc1doaXRlID0gZGF0YS5pc1doaXRlO1xuXG4gICAgfTtcblxuICAgIFN0b25lLnByb3RvdHlwZSA9IHtcblxuICAgICAgICBkcmF3QXJjOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5hcmMoZGF0YS54LCBkYXRhLnksIGRhdGEuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gc2VsZi5pc1doaXRlID4gMCA/ICcjZmZmZmZmJyA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV2ZXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5hcmMoc2VsZi5kYXRhLngsIHNlbGYuZGF0YS55LCBzZWxmLmRhdGEuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gc2VsZi5pc1doaXRlICogLTEgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbCgpO1xuICAgICAgICAgICAgc2VsZi5jdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uU3RvbmUgPSBTdG9uZTtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcblxuICAgICAgICBpZiAoIWNhbnZhcy5nZXRDb250ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXBwZXInKTtcbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGN0eC5jYW52YXMud2lkdGggPSB3cmFwcGVyLmNsaWVudFdpZHRoO1xuICAgICAgICBjdHguY2FudmFzLmhlaWdodCA9IHdyYXBwZXIuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIGxldCBwbGF5ZXJEYXRhID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdibGFjaydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgYm9hcmQgPSBuZXcgbXlPdGhlbGxvLkJvYXJkTWFuYWdlcihjdHgpO1xuXG4gICAgICAgIGJvYXJkLnN0YXJ0R2FtZSgpO1xuXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgYm9hcmQucHV0U3RvbmUoZS5vZmZzZXRYLCBlLm9mZnNldFkpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIOODleOCo+ODvOODq+ODieOCkuabuOOBj++8iDh4OO+8iVxuICAgICAgICAvLyDlkITjg57jgrnnm67jga7jgqjjg6rjgqLmg4XloLHjgpLkv53mjIHvvIhzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWe+8iVxuICAgICAgICAvLyAgICAgIOOCr+ODquODg+OCr+OBl+OBn+S9jee9ruOBqGNhbnZhc+S4iuOBruS9jee9ruOBruWkieaPm+OBjOW/heimge+8n1xuICAgICAgICAvLyDjg5fjg6zjgqTjg6Tjg7znmb3jg7vpu5LjgpLjgrvjg4Pjg4hcbiAgICAgICAgLy8gICAgICDjg5Xjg6njgrDjgavjgZnjgovvvJ9cbiAgICAgICAgLy8g5Lit5aSu44Gr55m96buSMuOBk+OBmuOBpOOCu+ODg+ODiFxuXG4gICAgICAgIC8vIOWQhOODl+ODrOOCpOODpOODvOOBrue9ruOBhOOBn+efs+OCkuS/neaMgeOBmeOCi+mFjeWIl1xuICAgICAgICAvL1xuXG5cblxuICAgIH0pO1xuXG59KCkpO1xuXG4vKipcbiAqIC8vIFRPRE8g6LOq5ZWPXG4gKlxuICogMS5cbiDjgIzliKTlrprjgZnjgovjgI3jgajjgYTjgYboi7Hoqp7jga/kvZXjgpLkvb/jgaPjgabjgb7jgZnjgYvvvJ9cblxuIGZpbmQ/IGp1ZGdlPyBkZWNpZGU/XG5cblxuIDIuXG4gY2hyb21l44GuZGV244OE44O844Or44Gn44Kk44Oz44K544K/44Oz44K544Gr5YWl44Gj44Gm44GE44KLdOOBqOOBr+OBquOCk+OBruaEj+WRs+OAgeeVpe+8iO+8n++8ieOBp+OBmeOBi++8n+OCpOODs+OCueOCv+ODs+OCueOCkuODreOCsOOBq+WHuuOBmeOBqHTjgajjgarjgovvvJ9cbiBib2FyZC5zdGFydEdhbWXjga7mnIDlvozjgadjb25zb2xlLmxvZyhzZWxmLnN0b25lUG9zZXMpO+OBmeOCi+OBqOeiuuiqjeOBp+OBjeOCi1xuXG4gKi9cbiJdfQ==