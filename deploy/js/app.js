!function(){const t=function(t){this.ctx=t,this.cautionText=document.getElementById("caution"),this.stoneColorText=document.getElementById("stoneColor"),this.GRID_SIZE=50,this.LINE_NUMBER=9,this.R=.3*this.GRID_SIZE,this.color="#ffffff",this.isWhite=1,this.board=[],this.turnStones=[],this.init()};t.prototype={init:function(){const t=this;t.ctx.translate(1,1),t.drawBoard();for(let e=1;e<t.LINE_NUMBER;e++){let e=[];for(let i=1;i<t.LINE_NUMBER;i++)e.push({});t.board.push(e)}},drawBoard:function(){const t=this,e=t.GRID_SIZE*(t.LINE_NUMBER-1);let i=0,n=0;t.drawRect(i,n,e,e,"#008833");for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(i,0,i,e),i+=t.GRID_SIZE;for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(0,n,e,n),n+=t.GRID_SIZE},drawRect:function(t,e,i,n,o){this.ctx.fillStyle=void 0!==o?o:"#000000",this.ctx.fillRect(t,e,i,n)},drawLine:function(t,e,i,n,o,s){this.ctx.strokeStyle=void 0!==o?o:"#000000",this.ctx.lineWidth=void 0!==s?s:1,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.closePath(),this.ctx.stroke()},startGame:function(){const t=this,e=t.GRID_SIZE*((t.LINE_NUMBER-1)/2),i=t.GRID_SIZE/2;let n,o,s=-1,h=-1,l=1;function c(c){for(let r=0;r<2;r++){let c={r:t.R};n=e+s*i,o=e+h*i,c.x=n,c.y=o,c.isWhite=l;let r=new window.myOthello.Stone(t.ctx,c);r.drawArc(c);let a=t.board[Math.floor(o/t.GRID_SIZE)][Math.floor(n/t.GRID_SIZE)];a.instance=r,a.isWhite=l,s*=-1,h*=-1}}c(),s*=-1,l*=-1,c()},validate:function(){const t=this;t.cautionText.classList.contains("isVisible")||(t.cautionText.classList.add("isVisible"),setTimeout(function(){t.cautionText.classList.remove("isVisible")},1e3))},putStone:function(t,e){const i=this;let n=Math.floor(t/i.GRID_SIZE),o=Math.floor(e/i.GRID_SIZE);if(!i.checkVacancy(n,o))return void i.validate();if(!i.checkNeighbor(n,o))return void i.validate();if(!i.checkIfPossible(n,o))return void i.validate();i.isWhite*=-1,color=i.isWhite>0?"#ffffff":"#000000";let s={x:i.GRID_SIZE*n+i.GRID_SIZE/2,y:i.GRID_SIZE*o+i.GRID_SIZE/2,r:i.R,isWhite:i.isWhite},h=new window.myOthello.Stone(i.ctx,s);h.drawArc(s);let l=i.board[o][n];l.instance=h,l.isWhite=i.isWhite,i.turnStones.length>0&&(i.turnStones.forEach(function(t){t.isWhite*=-1,t.instance.reverse()}),i.turnStones.length=0),i.stoneColorText.classList.contains("js-isWhite")?(i.stoneColorText.textContent="黒",i.stoneColorText.classList.remove("js-isWhite")):(i.stoneColorText.textContent="白",i.stoneColorText.classList.add("js-isWhite"))},checkVacancy:function(t,e){return Object.keys(this.board[e][t]).length<=0},checkNeighbor:function(t,e){const i=this;let n,o,s=[[t,e-1],[t+1,e-1],[t+1,e],[t+1,e+1],[t,e+1],[t-1,e+1],[t-1,e],[t-1,e-1]];for(let h=0,l=s.length;h<l;h++)if(o=s[h][1],n=s[h][0],!(o<0||o>7||n<0||n>7)&&Object.keys(i.board[o][n]).length>0)return!0},checkIfPossible:function(t,e){const i=this,n=i.LINE_NUMBER-1-1;let o=!1,s=!1,h=null,l=null,c=[];return function(){for(let r=1;r<n&&!(e-r<0);r++)if(h=i.board[e-r][t],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((l=i.board[e-n][t]).y=e-n,l.x=t,!(Object.keys(l).length>0&&l.isWhite===i.isWhite)){s=!1,c.length=0;break}s=!0,c.push(l)}if(s){for(let t=0,e=c.length;t<e;t++)i.turnStones.push(c[t]);c.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(e+r>7);r++)if(h=i.board[e+r][t],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((l=i.board[e+n][t]).y=e+n,l.x=t,!(Object.keys(l).length>0&&l.isWhite===i.isWhite)){s=!1,c.length=0;break}s=!0,c.push(l)}if(s){for(let t=0,e=c.length;t<e;t++)i.turnStones.push(c[t]);c.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(t-r<0);r++)if(h=i.board[e][t-r],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((l=i.board[e][t-n]).y=e,l.x=t-n,!(Object.keys(l).length>0&&l.isWhite===i.isWhite)){s=!1,c.length=0;break}s=!0,c.push(l)}if(s){for(let t=0,e=c.length;t<e;t++)i.turnStones.push(c[t]);c.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(t+r>7);r++)if(h=i.board[e][t+r],Object.keys(h).length>0&&-1*h.isWhite===i.isWhite){for(let n=1;n<r;n++){if((l=i.board[e][t+n]).y=e,l.x=t+n,!(Object.keys(l).length>0&&l.isWhite===i.isWhite)){s=!1,c.length=0;break}s=!0,c.push(l)}if(s){for(let t=0,e=c.length;t<e;t++)i.turnStones.push(c[t]);c.length=0,o=!0;break}}}(),o}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.BoardManager=t}(),function(){const t=function(t,e){this.canvas=t,this.color=e.color,this.stones=[],this.init()};t.prototype={init:function(){this.setEvent()},setEvent:function(){},getClickPos:function(){}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Player=t}(),function(){const t=function(t,e){this.ctx=t,this.data=e,this.isWhite=e.isWhite};t.prototype={drawArc:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()},reverse:function(){this.isWhite*=-1,this.ctx.beginPath(),this.ctx.arc(this.data.x,this.data.y,this.data.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Stone=t}(),document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("canvas");if(!t.getContext)return;const e=document.getElementById("wrapper"),i=t.getContext("2d");i.canvas.width=e.clientWidth,i.canvas.height=e.clientHeight;const n=new myOthello.BoardManager(i);n.startGame(),t.addEventListener("click",function(t){n.putStone(t.offsetX,t.offsetY)})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJvYXJkTWFuYWdlci5qcyIsIlBsYXllci5qcyIsIlN0b25lLmpzIiwic2NyaXB0LmpzIl0sIm5hbWVzIjpbIkJvYXJkTWFuYWdlciIsImN0eCIsInRoaXMiLCJjYXV0aW9uVGV4dCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdG9uZUNvbG9yVGV4dCIsIkdSSURfU0laRSIsIkxJTkVfTlVNQkVSIiwiUiIsImNvbG9yIiwiaXNXaGl0ZSIsImJvYXJkIiwidHVyblN0b25lcyIsImluaXQiLCJwcm90b3R5cGUiLCJzZWxmIiwidHJhbnNsYXRlIiwiZHJhd0JvYXJkIiwiaSIsInJvdyIsImoiLCJwdXNoIiwiZmllbGRTaXplIiwieCIsInkiLCJkcmF3UmVjdCIsImRyYXdMaW5lIiwieDEiLCJ5MSIsIngyIiwieTIiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsIndpZHRoIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJzdGFydEdhbWUiLCJjZW50ZXIiLCJkaWZmIiwicG9zWCIsInBvc1kiLCJkaXIxIiwiZGlyMiIsInNldEZpcnN0U3RvbmUiLCJkYXRhIiwiciIsInN0b25lIiwid2luZG93IiwibXlPdGhlbGxvIiwiU3RvbmUiLCJkcmF3QXJjIiwib2JqIiwiTWF0aCIsImZsb29yIiwiaW5zdGFuY2UiLCJ2YWxpZGF0ZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiYWRkIiwic2V0VGltZW91dCIsInJlbW92ZSIsInB1dFN0b25lIiwiY2xpY2tlZFgiLCJjbGlja2VkWSIsIm50aEdyaWRYIiwibnRoR3JpZFkiLCJjaGVja1ZhY2FuY3kiLCJjaGVja05laWdoYm9yIiwiY2hlY2tJZlBvc3NpYmxlIiwibGVuZ3RoIiwiZm9yRWFjaCIsInZhbCIsInJldmVyc2UiLCJ0ZXh0Q29udGVudCIsIm50aFgiLCJudGhZIiwiT2JqZWN0Iiwia2V5cyIsImxpbmUiLCJuZWlnaGJvcnMiLCJsZW4iLCJNQVhfQ09VTlQiLCJpc1Bvc3NpYmxlIiwiaXNUbXBQb3NzaWJsZSIsInRtcE9iaiIsInRtcFR1cm5TdG9uZXMiLCJjaGVja1RvcCIsImNoZWNrQm90dG9tIiwiY2hlY2tMZWZ0IiwiY2hlY2tSaWdodCIsIlBsYXllciIsImNhbnZhcyIsInN0b25lcyIsInNldEV2ZW50IiwiZ2V0Q2xpY2tQb3MiLCJhcmMiLCJQSSIsImZpbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0Q29udGV4dCIsIndyYXBwZXIiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsImUiLCJvZmZzZXRYIiwib2Zmc2V0WSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxNQUFBQSxFQUFBLFNBQUFDLEdBQ0FDLEtBRUFELElBQUFBLEVBRkFDLEtBS0FDLFlBQUFDLFNBQUFDLGVBQUEsV0FMQUgsS0FNQUksZUFBQUYsU0FBQUMsZUFBQSxjQU5BSCxLQVFBSyxVQUFBLEdBUkFMLEtBU0FNLFlBQUEsRUFUQU4sS0FVQU8sRUFBQSxHQVZBUCxLQVVBSyxVQVZBTCxLQVlBUSxNQUFBLFVBWkFSLEtBYUFTLFFBQUEsRUFiQVQsS0FlQVUsU0FmQVYsS0FpQkFXLGNBakJBWCxLQW1CQVksUUFHQWQsRUFBQWUsV0FLQUQsS0FBQSxXQUNBLE1BQUFFLEVBQUFkLEtBR0FjLEVBQUFmLElBQUFnQixVQUFBLEVBQUEsR0FFQUQsRUFBQUUsWUFFQSxJQUFBLElBQUFDLEVBQUEsRUFBQUEsRUFBQUgsRUFBQVIsWUFBQVcsSUFBQSxDQUNBLElBQUFDLEtBRUEsSUFBQSxJQUFBQyxFQUFBLEVBQUFBLEVBQUFMLEVBQUFSLFlBQUFhLElBQ0FELEVBQUFFLFNBR0FOLEVBQUFKLE1BQUFVLEtBQUFGLEtBS0FGLFVBQUEsV0FDQSxNQUFBRixFQUFBZCxLQUVBcUIsRUFBQVAsRUFBQVQsV0FBQVMsRUFBQVIsWUFBQSxHQUVBLElBQUFnQixFQUFBLEVBQ0FDLEVBQUEsRUFFQVQsRUFBQVUsU0FBQUYsRUFBQUMsRUFB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QWdHLE9BQUEvRCxNQUFBd0UsRUFBQUMsWUFDQTFHLEVBQUFnRyxPQUFBVyxPQUFBRixFQUFBRyxhQWlCQSxNQUFBakcsRUFBQSxJQUFBMEMsVUFBQXRELGFBQUFDLEdBRUFXLEVBQUE4QixZQUVBdUQsRUFBQU8saUJBQUEsUUFBQSxTQUFBTSxHQUVBbEcsRUFBQXVELFNBQUEyQyxFQUFBQyxRQUFBRCxFQUFBRSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyI7KGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgQm9hcmRNYW5hZ2VyID0gZnVuY3Rpb24oY3R4KSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuY3R4ID0gY3R4O1xuXG4gICAgICAgIC8vIERPTVxuICAgICAgICBzZWxmLmNhdXRpb25UZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdXRpb24nKTtcbiAgICAgICAgc2VsZi5zdG9uZUNvbG9yVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9uZUNvbG9yJyk7XG5cbiAgICAgICAgc2VsZi5HUklEX1NJWkUgPSA1MDtcbiAgICAgICAgc2VsZi5MSU5FX05VTUJFUiA9IDk7XG4gICAgICAgIHNlbGYuUiA9IHNlbGYuR1JJRF9TSVpFICogMC4zO1xuXG4gICAgICAgIHNlbGYuY29sb3IgPSAnI2ZmZmZmZic7XG4gICAgICAgIHNlbGYuaXNXaGl0ZSA9IDE7XG5cbiAgICAgICAgc2VsZi5ib2FyZCA9IFtdO1xuXG4gICAgICAgIHNlbGYudHVyblN0b25lcyA9IFtdO1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH07XG5cbiAgICBCb2FyZE1hbmFnZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8geD0wLCB5PTDjgaflhYjjga7lpKrjgZXjgYzljYrliIbjgZfmj4/lhpnjgZXjgozjgarjgYTjgZ/jgoHjgIHln7rmupbngrnjgpLjgZrjgonjgZlcbiAgICAgICAgICAgIHNlbGYuY3R4LnRyYW5zbGF0ZSgxLCAxKTtcblxuICAgICAgICAgICAgc2VsZi5kcmF3Qm9hcmQoKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWxmLkxJTkVfTlVNQkVSOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgcm93ID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IHNlbGYuTElORV9OVU1CRVI7IGorKykge1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaCh7fSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5ib2FyZC5wdXNoKHJvdyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3Qm9hcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGZpZWxkU2l6ZSA9IHNlbGYuR1JJRF9TSVpFICogKHNlbGYuTElORV9OVU1CRVIgLSAxKTtcblxuICAgICAgICAgICAgbGV0IHggPSAwO1xuICAgICAgICAgICAgbGV0IHkgPSAwO1xuXG4gICAgICAgICAgICBzZWxmLmRyYXdSZWN0KHgsIHksIGZpZWxkU2l6ZSwgZmllbGRTaXplLCAnIzAwODgzMycpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzZWxmLkxJTkVfTlVNQkVSOyBpKyspIHtcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdMaW5lKHgsIDAsIHgsIGZpZWxkU2l6ZSk7XG4gICAgICAgICAgICAgICAgeCArPSBzZWxmLkdSSURfU0laRTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlbGYuZHJhd0xpbmUoMCwgeSwgZmllbGRTaXplLCB5KTtcbiAgICAgICAgICAgICAgICB5ICs9IHNlbGYuR1JJRF9TSVpFO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhd1JlY3Q6IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBjb2xvcikge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGxTdHlsZSA9IHR5cGVvZiBjb2xvciAhPT0gJ3VuZGVmaW5lZCcgPyBjb2xvciA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGxSZWN0KHgxLCB5MSwgeDIsIHkyKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdMaW5lOiBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgY29sb3IsIHdpZHRoKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguc3Ryb2tlU3R5bGUgPSB0eXBlb2YgY29sb3IgIT09ICd1bmRlZmluZWQnID8gY29sb3IgOiAnIzAwMDAwMCc7XG4gICAgICAgICAgICBzZWxmLmN0eC5saW5lV2lkdGggPSB0eXBlb2Ygd2lkdGggIT09ICd1bmRlZmluZWQnID8gd2lkdGggOiAxO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4Lm1vdmVUbyh4MSwgeTEpO1xuICAgICAgICAgICAgc2VsZi5jdHgubGluZVRvKHgyLCB5Mik7XG4gICAgICAgICAgICBzZWxmLmN0eC5jbG9zZVBhdGgoKTtcblxuICAgICAgICAgICAgc2VsZi5jdHguc3Ryb2tlKCk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IHNlbGYuR1JJRF9TSVpFICogKChzZWxmLkxJTkVfTlVNQkVSIC0gMSkgLyAyKTtcbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSAoc2VsZi5HUklEX1NJWkUgLyAyKTtcbiAgICAgICAgICAgIGxldCBkaXIxID0gLTE7XG4gICAgICAgICAgICBsZXQgZGlyMiA9IC0xO1xuICAgICAgICAgICAgbGV0IHBvc1gsIHBvc1k7XG4gICAgICAgICAgICBsZXQgaXNXaGl0ZSA9IDE7XG5cbiAgICAgICAgICAgIHNldEZpcnN0U3RvbmUoKTtcbiAgICAgICAgICAgIGRpcjEgKj0gLTE7XG4gICAgICAgICAgICBpc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgc2V0Rmlyc3RTdG9uZSgpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRGaXJzdFN0b25lKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByOiBzZWxmLlJcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBwb3NYID0gY2VudGVyICsgZGlyMSAqIGRpZmY7XG4gICAgICAgICAgICAgICAgICAgIHBvc1kgPSBjZW50ZXIgKyBkaXIyICogZGlmZjtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnggPSBwb3NYO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnkgPSBwb3NZO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzV2hpdGUgPSBpc1doaXRlO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdG9uZSA9IG5ldyB3aW5kb3cubXlPdGhlbGxvLlN0b25lKHNlbGYuY3R4LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgc3RvbmUuZHJhd0FyYyhkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gc2VsZi5ib2FyZFtNYXRoLmZsb29yKHBvc1kgLyBzZWxmLkdSSURfU0laRSldW01hdGguZmxvb3IocG9zWCAvIHNlbGYuR1JJRF9TSVpFKV07XG4gICAgICAgICAgICAgICAgICAgIG9iai5pbnN0YW5jZSA9IHN0b25lO1xuICAgICAgICAgICAgICAgICAgICBvYmouaXNXaGl0ZSA9IGlzV2hpdGU7XG5cbiAgICAgICAgICAgICAgICAgICAgZGlyMSAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgZGlyMiAqPSAtMTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKCFzZWxmLmNhdXRpb25UZXh0LmNsYXNzTGlzdC5jb250YWlucygnaXNWaXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmNhdXRpb25UZXh0LmNsYXNzTGlzdC5hZGQoJ2lzVmlzaWJsZScpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2F1dGlvblRleHQuY2xhc3NMaXN0LnJlbW92ZSgnaXNWaXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgfSwgMTAwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwdXRTdG9uZTogZnVuY3Rpb24oY2xpY2tlZFgsIGNsaWNrZWRZKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgbGV0IG50aEdyaWRYID0gTWF0aC5mbG9vcihjbGlja2VkWCAvIHNlbGYuR1JJRF9TSVpFKTtcbiAgICAgICAgICAgIGxldCBudGhHcmlkWSA9IE1hdGguZmxvb3IoY2xpY2tlZFkgLyBzZWxmLkdSSURfU0laRSk7XG5cbiAgICAgICAgICAgIGlmICghc2VsZi5jaGVja1ZhY2FuY3kobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc2VsZi5jaGVja05laWdoYm9yKG50aEdyaWRYLCBudGhHcmlkWSkpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXNlbGYuY2hlY2tJZlBvc3NpYmxlKG50aEdyaWRYLCBudGhHcmlkWSkpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYuaXNXaGl0ZSAqPSAtMTtcbiAgICAgICAgICAgIGNvbG9yID0gc2VsZi5pc1doaXRlID4gMCA/ICcjZmZmZmZmJyA6ICcjMDAwMDAwJztcblxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgeDogKHNlbGYuR1JJRF9TSVpFICogbnRoR3JpZFgpICsgKHNlbGYuR1JJRF9TSVpFIC8gMiksXG4gICAgICAgICAgICAgICAgeTogKHNlbGYuR1JJRF9TSVpFICogbnRoR3JpZFkpICsgKHNlbGYuR1JJRF9TSVpFIC8gMiksXG4gICAgICAgICAgICAgICAgcjogc2VsZi5SLFxuICAgICAgICAgICAgICAgIGlzV2hpdGU6IHNlbGYuaXNXaGl0ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IHN0b25lID0gbmV3IHdpbmRvdy5teU90aGVsbG8uU3RvbmUoc2VsZi5jdHgsIGRhdGEpO1xuICAgICAgICAgICAgc3RvbmUuZHJhd0FyYyhkYXRhKTtcblxuICAgICAgICAgICAgbGV0IG9iaiA9IHNlbGYuYm9hcmRbbnRoR3JpZFldW250aEdyaWRYXTtcbiAgICAgICAgICAgIG9iai5pbnN0YW5jZSA9IHN0b25lO1xuICAgICAgICAgICAgb2JqLmlzV2hpdGUgPSBzZWxmLmlzV2hpdGU7XG5cbiAgICAgICAgICAgIGlmIChzZWxmLnR1cm5TdG9uZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICB2YWwuaXNXaGl0ZSAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgdmFsLmluc3RhbmNlLnJldmVyc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXNlbGYuc3RvbmVDb2xvclRleHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pc1doaXRlJykpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnN0b25lQ29sb3JUZXh0LnRleHRDb250ZW50ID0gJ+eZvSc7XG4gICAgICAgICAgICAgICAgc2VsZi5zdG9uZUNvbG9yVGV4dC5jbGFzc0xpc3QuYWRkKCdqcy1pc1doaXRlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGYuc3RvbmVDb2xvclRleHQudGV4dENvbnRlbnQgPSAn6buSJztcbiAgICAgICAgICAgICAgICBzZWxmLnN0b25lQ29sb3JUZXh0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlzV2hpdGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrVmFjYW5jeTogZnVuY3Rpb24obnRoWCwgbnRoWSkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhzZWxmLmJvYXJkW250aFldW250aFhdKS5sZW5ndGggPD0gMDtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrTmVpZ2hib3I6IGZ1bmN0aW9uKG50aFgsIG50aFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBsZXQgcm93LCBsaW5lO1xuXG4gICAgICAgICAgICBsZXQgbmVpZ2hib3JzID0gW1xuICAgICAgICAgICAgICAgIFtudGhYLCBudGhZIC0gMV0sICAgICAgIC8vIOS4ilxuICAgICAgICAgICAgICAgIFtudGhYICsgMSwgbnRoWSAtIDFdLCAgIC8vIOWPs+S4ilxuICAgICAgICAgICAgICAgIFtudGhYICsgMSwgbnRoWV0sICAgICAgIC8vIOWPs1xuICAgICAgICAgICAgICAgIFtudGhYICsgMSwgbnRoWSArIDFdLCAgIC8vIOWPs+S4i1xuICAgICAgICAgICAgICAgIFtudGhYLCBudGhZICsgMV0sICAgICAgIC8vIOS4i1xuICAgICAgICAgICAgICAgIFtudGhYIC0gMSwgbnRoWSArIDFdLCAgIC8vIOW3puS4i1xuICAgICAgICAgICAgICAgIFtudGhYIC0gMSwgbnRoWV0sICAgICAgIC8vIOW3plxuICAgICAgICAgICAgICAgIFtudGhYIC0gMSwgbnRoWSAtIDFdICAgIC8vIOW3puS4ilxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG5laWdoYm9ycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXG4gICAgICAgICAgICAgICAgbGluZSA9IG5laWdoYm9yc1tpXVsxXTtcbiAgICAgICAgICAgICAgICByb3cgPSBuZWlnaGJvcnNbaV1bMF07XG5cbiAgICAgICAgICAgICAgICBpZiAobGluZSA8IDAgfHwgbGluZSA+IDcgfHwgcm93IDwgMCB8fCByb3cgPiA3KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhzZWxmLmJvYXJkW2xpbmVdW3Jvd10pLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hlY2tJZlBvc3NpYmxlOiBmdW5jdGlvbihudGhYLCBudGhZKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHtcbiAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhpICsgJyAvIDQnKTtcbiAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhNYXRoLmNvcyhNYXRoLlBJIC8gNCAqIGkpLCBNYXRoLnNpbihNYXRoLlBJIC8gNCAqIGkpKTtcbiAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgY29uc3QgTUFYX0NPVU5UID0gKHNlbGYuTElORV9OVU1CRVIgLSAxKSAtIDE7IC8vICgo57ea44Gu5pWwLTEpIC0g6Ieq6Lqr44GM572u44GL44KM44KL44Oe44K5KVxuICAgICAgICAgICAgbGV0IGlzUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBpc1RtcFBvc3NpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgb2JqID0gbnVsbDtcbiAgICAgICAgICAgIGxldCB0bXBPYmogPSBudWxsO1xuICAgICAgICAgICAgbGV0IHRtcFR1cm5TdG9uZXMgPSBbXTtcblxuICAgICAgICAgICAgLy8g572u44GR44KL5p2h5Lu2XG4gICAgICAgICAgICAvLyDlt6blj7PjgIHkuIrkuIvjgIHmlpzjgoE0NeW6puS4iuOBq+WQjOOBmOiJsuOBruefs+OBjOOBguOCi1xuICAgICAgICAgICAgLy8g44GL44GkIOOBneOBruWQjOOBmOiJsuOBruefs+OBqOiHqui6q+OBrumWk+OBq+mamemWk+OBquOBj+WIpeOBruiJsuOBruefs+OBjOOBguOCi1xuXG4gICAgICAgICAgICAvLyBsZXQgbmVpZ2hib3JzID0gW1xuICAgICAgICAgICAgLy8gICAgIFtudGhYLCBudGhZIC0gMV0sICAgICAgIC8vIOS4ilxuICAgICAgICAgICAgLy8gICAgIFtudGhYICsgMSwgbnRoWSAtIDFdLCAgIC8vIOWPs+S4ilxuICAgICAgICAgICAgLy8gICAgIFtudGhYICsgMSwgbnRoWV0sICAgICAgIC8vIOWPs1xuICAgICAgICAgICAgLy8gICAgIFtudGhYICsgMSwgbnRoWSArIDFdLCAgIC8vIOWPs+S4i1xuICAgICAgICAgICAgLy8gICAgIFtudGhYLCBudGhZICsgMV0sICAgICAgIC8vIOS4i1xuICAgICAgICAgICAgLy8gICAgIFtudGhYIC0gMSwgbnRoWSArIDFdLCAgIC8vIOW3puS4i1xuICAgICAgICAgICAgLy8gICAgIFtudGhYIC0gMSwgbnRoWV0sICAgICAgIC8vIOW3plxuICAgICAgICAgICAgLy8gICAgIFtudGhYIC0gMSwgbnRoWSAtIDFdICAgIC8vIOW3puS4ilxuICAgICAgICAgICAgLy8gXTtcbiAgICAgICAgICAgIC8vIOOBp+OBneOCjOOBnuOCjOODgeOCp+ODg+OCr+OBmeOCi++8n1xuICAgICAgICAgICAgY2hlY2tUb3AoKTtcbiAgICAgICAgICAgIGNoZWNrQm90dG9tKCk7XG4gICAgICAgICAgICBjaGVja0xlZnQoKTtcbiAgICAgICAgICAgIGNoZWNrUmlnaHQoKTtcblxuXG4gICAgICAgICAgICByZXR1cm4gaXNQb3NzaWJsZTtcblxuXG4gICAgICAgICAgICAvLyDkuIrjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrVG9wKCkge1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBNQVhfQ09VTlQ7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChudGhZIC0gaSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8g6Ieq6Lqr44GL44KJ6Kmy5b2T5pa55ZCR44Gu5Lit44Gn5LiA55Wq6L+R44GE55+zXG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IHNlbGYuYm9hcmRbbnRoWSAtIGldW250aFhdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPiAwKSAmJiAob2JqLmlzV2hpdGUgKiAtMSA9PT0gc2VsZi5pc1doaXRlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IGk7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iaiA9IHNlbGYuYm9hcmRbbnRoWSAtIGpdW250aFhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai55ID0gbnRoWSAtIGo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnggPSBudGhYO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRtcE9iaikubGVuZ3RoID4gMCAmJiB0bXBPYmouaXNXaGl0ZSA9PT0gc2VsZi5pc1doaXRlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUbXBQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMucHVzaCh0bXBPYmopO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMubGVuZ3RoID0gMDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RtcFBvc3NpYmxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gdG1wVHVyblN0b25lcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnR1cm5TdG9uZXMucHVzaCh0bXBUdXJuU3RvbmVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUG9zc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyDkuIvjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrQm90dG9tKCkge1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBNQVhfQ09VTlQ7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChudGhZICsgaSA+IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZICsgaV1bbnRoWF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA+IDApICYmIChvYmouaXNXaGl0ZSAqIC0xID09PSBzZWxmLmlzV2hpdGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqID0gc2VsZi5ib2FyZFtudGhZICsgal1bbnRoWF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnkgPSBudGhZICsgajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueCA9IG50aFg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModG1wT2JqKS5sZW5ndGggPiAwICYmIHRtcE9iai5pc1doaXRlID09PSBzZWxmLmlzV2hpdGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVG1wUG9zc2libGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSB0bXBUdXJuU3RvbmVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcFR1cm5TdG9uZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgLy8g5bem44KS44OB44Kn44OD44KvXG4gICAgICAgICAgICBmdW5jdGlvbiBjaGVja0xlZnQoKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFggLSBpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyDoh6rouqvjgYvjgonoqbLlvZPmlrnlkJHjga7kuK3jgafkuIDnlarov5HjgYTnn7NcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZXVtudGhYIC0gaV07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA+IDApICYmIChvYmouaXNXaGl0ZSAqIC0xID09PSBzZWxmLmlzV2hpdGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqID0gc2VsZi5ib2FyZFtudGhZXVtudGhYIC0gal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnkgPSBudGhZO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai54ID0gbnRoWCAtIGo7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModG1wT2JqKS5sZW5ndGggPiAwICYmIHRtcE9iai5pc1doaXRlID09PSBzZWxmLmlzV2hpdGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVG1wUG9zc2libGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSB0bXBUdXJuU3RvbmVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcFR1cm5TdG9uZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlj7PjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrUmlnaHQoKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFggKyBpID4gNykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyDoh6rouqvjgYvjgonoqbLlvZPmlrnlkJHjga7kuK3jgafkuIDnlarov5HjgYTnn7NcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZXVtudGhYICsgaV07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA+IDApICYmIChvYmouaXNXaGl0ZSAqIC0xID09PSBzZWxmLmlzV2hpdGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqID0gc2VsZi5ib2FyZFtudGhZXVtudGhYICsgal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnkgPSBudGhZO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai54ID0gbnRoWCArIGo7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModG1wT2JqKS5sZW5ndGggPiAwICYmIHRtcE9iai5pc1doaXRlID09PSBzZWxmLmlzV2hpdGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVG1wUG9zc2libGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSB0bXBUdXJuU3RvbmVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcFR1cm5TdG9uZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuXG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93Lm15T3RoZWxsbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgd2luZG93Lm15T3RoZWxsbyA9IHt9O1xuICAgIH1cbiAgICB3aW5kb3cubXlPdGhlbGxvLkJvYXJkTWFuYWdlciA9IEJvYXJkTWFuYWdlcjtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgUGxheWVyID0gZnVuY3Rpb24oY2FudmFzLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuY2FudmFzID0gY2FudmFzO1xuXG4gICAgICAgIHNlbGYuY29sb3IgPSBkYXRhLmNvbG9yO1xuICAgICAgICBzZWxmLnN0b25lcyA9IFtdO1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH07XG5cbiAgICBQbGF5ZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHNlbGYuc2V0RXZlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gc2VsZi5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coZS5vZmZzZXRYKTtcbiAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Q2xpY2tQb3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uUGxheWVyID0gUGxheWVyO1xuXG59KCkpOyIsIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBTdG9uZSA9IGZ1bmN0aW9uKGN0eCwgZGF0YSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmN0eCA9IGN0eDtcbiAgICAgICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICAgICAgc2VsZi5pc1doaXRlID0gZGF0YS5pc1doaXRlO1xuXG4gICAgfTtcblxuICAgIFN0b25lLnByb3RvdHlwZSA9IHtcblxuICAgICAgICBkcmF3QXJjOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5hcmMoZGF0YS54LCBkYXRhLnksIGRhdGEuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gc2VsZi5pc1doaXRlID4gMCA/ICcjZmZmZmZmJyA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV2ZXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5pc1doaXRlICo9IC0xO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmFyYyhzZWxmLmRhdGEueCwgc2VsZi5kYXRhLnksIHNlbGYuZGF0YS5yLCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7XG4gICAgICAgICAgICBzZWxmLmN0eC5maWxsU3R5bGUgPSBzZWxmLmlzV2hpdGUgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbCgpO1xuICAgICAgICAgICAgc2VsZi5jdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uU3RvbmUgPSBTdG9uZTtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcblxuICAgICAgICBpZiAoIWNhbnZhcy5nZXRDb250ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXBwZXInKTtcbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGN0eC5jYW52YXMud2lkdGggPSB3cmFwcGVyLmNsaWVudFdpZHRoO1xuICAgICAgICBjdHguY2FudmFzLmhlaWdodCA9IHdyYXBwZXIuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIGxldCBwbGF5ZXJEYXRhID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdibGFjaydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgYm9hcmQgPSBuZXcgbXlPdGhlbGxvLkJvYXJkTWFuYWdlcihjdHgpO1xuXG4gICAgICAgIGJvYXJkLnN0YXJ0R2FtZSgpO1xuXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgYm9hcmQucHV0U3RvbmUoZS5vZmZzZXRYLCBlLm9mZnNldFkpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIOODleOCo+ODvOODq+ODieOCkuabuOOBj++8iDh4OO+8iVxuICAgICAgICAvLyDlkITjg57jgrnnm67jga7jgqjjg6rjgqLmg4XloLHjgpLkv53mjIHvvIhzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWe+8iVxuICAgICAgICAvLyAgICAgIOOCr+ODquODg+OCr+OBl+OBn+S9jee9ruOBqGNhbnZhc+S4iuOBruS9jee9ruOBruWkieaPm+OBjOW/heimge+8n1xuICAgICAgICAvLyDjg5fjg6zjgqTjg6Tjg7znmb3jg7vpu5LjgpLjgrvjg4Pjg4hcbiAgICAgICAgLy8gICAgICDjg5Xjg6njgrDjgavjgZnjgovvvJ9cbiAgICAgICAgLy8g5Lit5aSu44Gr55m96buSMuOBk+OBmuOBpOOCu+ODg+ODiFxuXG4gICAgICAgIC8vIOWQhOODl+ODrOOCpOODpOODvOOBrue9ruOBhOOBn+efs+OCkuS/neaMgeOBmeOCi+mFjeWIl1xuICAgICAgICAvL1xuXG5cblxuICAgIH0pO1xuXG59KCkpO1xuXG4vKipcbiAqIC8vIFRPRE8g6LOq5ZWPXG4gKlxuICogMS5cbiDjgIzliKTlrprjgZnjgovjgI3jgajjgYTjgYboi7Hoqp7jga/kvZXjgpLkvb/jgaPjgabjgb7jgZnjgYvvvJ9cblxuIGZpbmQ/IGp1ZGdlPyBkZWNpZGU/XG5cblxuIDIuXG4gY2hyb21l44GuZGV244OE44O844Or44Gn44Kk44Oz44K544K/44Oz44K544Gr5YWl44Gj44Gm44GE44KLdOOBqOOBr+OBquOCk+OBruaEj+WRs+OAgeeVpe+8iO+8n++8ieOBp+OBmeOBi++8n+OCpOODs+OCueOCv+ODs+OCueOCkuODreOCsOOBq+WHuuOBmeOBqHTjgajjgarjgovvvJ9cbiBib2FyZC5zdGFydEdhbWXjga7mnIDlvozjgadjb25zb2xlLmxvZyhzZWxmLnN0b25lUG9zZXMpO+OBmeOCi+OBqOeiuuiqjeOBp+OBjeOCi1xuXG4gKi9cbiJdfQ==