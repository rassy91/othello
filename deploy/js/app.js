!function(){const t=function(t){this.ctx=t,this.cautionText=document.getElementById("caution"),this.GRID_SIZE=50,this.LINE_NUMBER=9,this.R=.3*this.GRID_SIZE,this.color="#ffffff",this.isWhite=1,this.board=[],this.turnStones=[],this.init()};t.prototype={init:function(){const t=this;t.ctx.translate(1,1),t.drawBoard();for(let i=1;i<t.LINE_NUMBER;i++){let i=[];for(let e=1;e<t.LINE_NUMBER;e++)i.push({});t.board.push(i)}},drawBoard:function(){const t=this,i=t.GRID_SIZE*(t.LINE_NUMBER-1);let e=0,n=0;t.drawRect(e,n,i,i,"#008833");for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(e,0,e,i),e+=t.GRID_SIZE;for(let o=1;o<=t.LINE_NUMBER;o++)t.drawLine(0,n,i,n),n+=t.GRID_SIZE},drawRect:function(t,i,e,n,o){this.ctx.fillStyle=void 0!==o?o:"#000000",this.ctx.fillRect(t,i,e,n)},drawLine:function(t,i,e,n,o,s){this.ctx.strokeStyle=void 0!==o?o:"#000000",this.ctx.lineWidth=void 0!==s?s:1,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,n),this.ctx.closePath(),this.ctx.stroke()},startGame:function(){const t=this,i=t.GRID_SIZE*((t.LINE_NUMBER-1)/2),e=t.GRID_SIZE/2;let n,o,s=-1,h=-1,c=1;function l(l){for(let r=0;r<2;r++){let l={r:t.R};n=i+s*e,o=i+h*e,l.x=n,l.y=o,l.isWhite=c;let r=new window.myOthello.Stone(t.ctx,l);r.drawArc(l);let a=t.board[Math.floor(o/t.GRID_SIZE)][Math.floor(n/t.GRID_SIZE)];a.instance=r,a.isWhite=c,s*=-1,h*=-1}}l(),s*=-1,c*=-1,l()},validate:function(){const t=this;t.cautionText.classList.contains("isVisible")||(t.cautionText.classList.add("isVisible"),setTimeout(function(){t.cautionText.classList.remove("isVisible")},1e3))},putStone:function(t,i){const e=this;let n=Math.floor(t/e.GRID_SIZE),o=Math.floor(i/e.GRID_SIZE);if(!e.checkVacancy(n,o))return void e.validate();if(!e.checkNeighbor(n,o))return void e.validate();if(!e.checkIfPossible(n,o))return void e.validate();e.isWhite*=-1,color=e.isWhite>0?"#ffffff":"#000000";let s={x:e.GRID_SIZE*n+e.GRID_SIZE/2,y:e.GRID_SIZE*o+e.GRID_SIZE/2,r:e.R,isWhite:e.isWhite},h=new window.myOthello.Stone(e.ctx,s);h.drawArc(s);let c=e.board[o][n];c.instance=h,c.isWhite=e.isWhite,e.turnStones.length>0&&(e.turnStones.forEach(function(t){t.isWhite*=-1,t.instance.reverse()}),e.turnStones.length=0)},checkVacancy:function(t,i){return Object.keys(this.board[i][t]).length<=0},checkNeighbor:function(t,i){const e=this;let n,o,s=[[t,i-1],[t+1,i-1],[t+1,i],[t+1,i+1],[t,i+1],[t-1,i+1],[t-1,i],[t-1,i-1]];for(let h=0,c=s.length;h<c;h++)if(o=s[h][1],n=s[h][0],!(o<0||o>7||n<0||n>7)&&Object.keys(e.board[o][n]).length>0)return!0},checkIfPossible:function(t,i){const e=this,n=e.LINE_NUMBER-1-1;let o=!1,s=!1,h=null,c=null,l=[];return function(){for(let r=1;r<n&&!(i-r<0);r++)if(h=e.board[i-r][t],Object.keys(h).length>0&&-1*h.isWhite===e.isWhite){for(let n=1;n<r;n++){if((c=e.board[i-n][t]).y=i-n,c.x=t,!(Object.keys(c).length>0&&c.isWhite===e.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,i=l.length;t<i;t++)e.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),function(){for(let r=1;r<n&&!(i+r>7);r++)if(h=e.board[i+r][t],Object.keys(h).length>0&&-1*h.isWhite===e.isWhite){for(let n=1;n<r;n++){if((c=e.board[i+n][t]).y=i+n,c.x=t,!(Object.keys(c).length>0&&c.isWhite===e.isWhite)){s=!1,l.length=0;break}s=!0,l.push(c)}if(s){for(let t=0,i=l.length;t<i;t++)e.turnStones.push(l[t]);l.length=0,o=!0;break}}}(),o}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.BoardManager=t}(),function(){const t=function(t,i){this.canvas=t,this.color=i.color,this.stones=[],this.init()};t.prototype={init:function(){this.setEvent()},setEvent:function(){},getClickPos:function(){}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Player=t}(),function(){const t=function(t,i){this.ctx=t,this.data=i,this.isWhite=i.isWhite};t.prototype={drawArc:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),this.ctx.fillStyle=this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()},reverse:function(){this.ctx.beginPath(),this.ctx.arc(this.data.x,this.data.y,this.data.r,0,2*Math.PI,!0),this.ctx.fillStyle=-1*this.isWhite>0?"#ffffff":"#000000",this.ctx.fill(),this.ctx.closePath()}},void 0===window.myOthello&&(window.myOthello={}),window.myOthello.Stone=t}(),document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("canvas");if(!t.getContext)return;const i=document.getElementById("wrapper"),e=t.getContext("2d");e.canvas.width=i.clientWidth,e.canvas.height=i.clientHeight;const n=new myOthello.BoardManager(e);n.startGame(),t.addEventListener("click",function(t){n.putStone(t.offsetX,t.offsetY)})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJvYXJkTWFuYWdlci5qcyIsIlBsYXllci5qcyIsIlN0b25lLmpzIiwic2NyaXB0LmpzIl0sIm5hbWVzIjpbIkJvYXJkTWFuYWdlciIsImN0eCIsInRoaXMiLCJjYXV0aW9uVGV4dCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJHUklEX1NJWkUiLCJMSU5FX05VTUJFUiIsIlIiLCJjb2xvciIsImlzV2hpdGUiLCJib2FyZCIsInR1cm5TdG9uZXMiLCJpbml0IiwicHJvdG90eXBlIiwic2VsZiIsInRyYW5zbGF0ZSIsImRyYXdCb2FyZCIsImkiLCJyb3ciLCJqIiwicHVzaCIsImZpZWxkU2l6ZSIsIngiLCJ5IiwiZHJhd1JlY3QiLCJkcmF3TGluZSIsIngxIiwieTEiLCJ4MiIsInkyIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJ3aWR0aCIsInN0cm9rZVN0eWxlIiwibGluZVdpZHRoIiwiYmVnaW5QYXRoIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwic3RhcnRHYW1lIiwiY2VudGVyIiwiZGlmZiIsInBvc1giLCJwb3NZIiwiZGlyMSIsImRpcjIiLCJzZXRGaXJzdFN0b25lIiwiZGF0YSIsInIiLCJzdG9uZSIsIndpbmRvdyIsIm15T3RoZWxsbyIsIlN0b25lIiwiZHJhd0FyYyIsIm9iaiIsIk1hdGgiLCJmbG9vciIsImluc3RhbmNlIiwidmFsaWRhdGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZCIsInNldFRpbWVvdXQiLCJyZW1vdmUiLCJwdXRTdG9uZSIsImNsaWNrZWRYIiwiY2xpY2tlZFkiLCJudGhHcmlkWCIsIm50aEdyaWRZIiwiY2hlY2tWYWNhbmN5IiwiY2hlY2tOZWlnaGJvciIsImNoZWNrSWZQb3NzaWJsZSIsImxlbmd0aCIsImZvckVhY2giLCJ2YWwiLCJyZXZlcnNlIiwibnRoWCIsIm50aFkiLCJPYmplY3QiLCJrZXlzIiwibGluZSIsIm5laWdoYm9ycyIsImxlbiIsIk1BWF9DT1VOVCIsImlzUG9zc2libGUiLCJpc1RtcFBvc3NpYmxlIiwidG1wT2JqIiwidG1wVHVyblN0b25lcyIsImNoZWNrVG9wIiwiY2hlY2tCb3R0b20iLCJQbGF5ZXIiLCJjYW52YXMiLCJzdG9uZXMiLCJzZXRFdmVudCIsImdldENsaWNrUG9zIiwiYXJjIiwiUEkiLCJmaWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdldENvbnRleHQiLCJ3cmFwcGVyIiwiY2xpZW50V2lkdGgiLCJoZWlnaHQiLCJjbGllbnRIZWlnaHQiLCJlIiwib2Zmc2V0WCIsIm9mZnNldFkiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsTUFBQUEsRUFBQSxTQUFBQyxHQUNBQyxLQUVBRCxJQUFBQSxFQUZBQyxLQUdBQyxZQUFBQyxTQUFBQyxlQUFBLFdBSEFILEtBTUFJLFVBQUEsR0FOQUosS0FPQUssWUFBQSxFQVBBTCxLQVFBTSxFQUFBLEdBUkFOLEtBUUFJLFVBUkFKLEtBVUFPLE1BQUEsVUFWQVAsS0FXQVEsUUFBQSxFQVhBUixLQWFBUyxTQWJBVCxLQWVBVSxjQWZBVixLQWlCQVcsUUFHQWIsRUFBQWMsV0FLQUQsS0FBQSxXQUNBLE1BQUFFLEVBQUFiLEtBR0FhLEVBQUFkLElBQUFlLFVBQUEsRUFBQSxHQUVBRCxFQUFBRSxZQUVBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBSCxFQUFBUixZQUFBVyxJQUFBLENBQ0EsSUFBQUMsS0FFQSxJQUFBLElBQUFDLEVBQUEsRUFBQUEsRUFBQUwsRUFBQVIsWUFBQWEsSUFDQUQsRUFBQUUsU0FHQU4sRUFBQUosTUFBQVUsS0FBQUYsS0FLQUYsVUFBQSxXQUNBLE1BQUFGLEVBQUFiLEtBRUFvQixFQUFBUCxFQUFBVCxXQUFBUyxFQUFBUixZQUFBLEdBRUEsSUFBQWdCLEVBQUEsRUFDQUMsRUFBQSxFQUVBVCxFQUFBVSxTQUFBRixFQUFBQyxFQUFBRixFQUFBQSxFQUFBLFdBRUEsSUFBQSxJQUFBSixFQUFBLEVBQUFBLEdBQUFILEVBQUFSLFlBQUFXLElBQ0FILEVBQUFXLFNBQUFILEVBQUEsRUFBQUEs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QStDLEtBQUExQixFQUhBckIsS0FHQStDLEtBQUF6QixFQUhBdEIsS0FHQStDLEtBQUFDLEVBQUEsRUFBQSxFQUFBTyxLQUFBeUMsSUFBQSxHQUhBaEcsS0FJQUQsSUFBQThCLFdBQUEsRUFKQTdCLEtBSUFRLFFBQUEsRUFBQSxVQUFBLFVBSkFSLEtBS0FELElBQUFrRyxPQUxBakcsS0FNQUQsSUFBQXNDLG1CQUlBLElBQUFhLE9BQUFDLFlBQ0FELE9BQUFDLGNBRUFELE9BQUFDLFVBQUFDLE1BQUFBLEVBdENBLEdDRUFsRCxTQUFBZ0csaUJBQUEsbUJBQUEsV0FFQSxNQUFBUCxFQUFBekYsU0FBQUMsZUFBQSxVQUVBLElBQUF3RixFQUFBUSxXQUNBLE9BR0EsTUFBQUMsRUFBQWxHLFNBQUFDLGVBQUEsV0FDQUosRUFBQTRGLEVBQUFRLFdBQUEsTUFDQXBHLEVBQUE0RixPQUFBNUQsTUFBQXFFLEVBQUFDLFlBQ0F0RyxFQUFBNEYsT0FBQVcsT0FBQUYsRUFBQUcsYUFpQkEsTUFBQTlGLEVBQUEsSUFBQTBDLFVBQUFyRCxhQUFBQyxHQUVBVSxFQUFBOEIsWUFFQW9ELEVBQUFPLGlCQUFBLFFBQUEsU0FBQU0sR0FFQS9GLEVBQUF1RCxTQUFBd0MsRUFBQUMsUUFBQUQsRUFBQUUiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyhmdW5jdGlvbigpIHtcblxuICAgIGNvbnN0IEJvYXJkTWFuYWdlciA9IGZ1bmN0aW9uKGN0eCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmN0eCA9IGN0eDtcbiAgICAgICAgc2VsZi5jYXV0aW9uVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXV0aW9uJyk7XG5cblxuICAgICAgICBzZWxmLkdSSURfU0laRSA9IDUwO1xuICAgICAgICBzZWxmLkxJTkVfTlVNQkVSID0gOTtcbiAgICAgICAgc2VsZi5SID0gc2VsZi5HUklEX1NJWkUgKiAwLjM7XG5cbiAgICAgICAgc2VsZi5jb2xvciA9ICcjZmZmZmZmJztcbiAgICAgICAgc2VsZi5pc1doaXRlID0gMTtcblxuICAgICAgICBzZWxmLmJvYXJkID0gW107XG5cbiAgICAgICAgc2VsZi50dXJuU3RvbmVzID0gW107XG5cbiAgICAgICAgc2VsZi5pbml0KCk7XG4gICAgfTtcblxuICAgIEJvYXJkTWFuYWdlci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqL1xuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyB4PTAsIHk9MOOBp+WFiOOBruWkquOBleOBjOWNiuWIhuOBl+aPj+WGmeOBleOCjOOBquOBhOOBn+OCgeOAgeWfuua6lueCueOCkuOBmuOCieOBmVxuICAgICAgICAgICAgc2VsZi5jdHgudHJhbnNsYXRlKDEsIDEpO1xuXG4gICAgICAgICAgICBzZWxmLmRyYXdCb2FyZCgpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgc2VsZi5MSU5FX05VTUJFUjsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvdy5wdXNoKHt9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZWxmLmJvYXJkLnB1c2gocm93KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXdCb2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgY29uc3QgZmllbGRTaXplID0gc2VsZi5HUklEX1NJWkUgKiAoc2VsZi5MSU5FX05VTUJFUiAtIDEpO1xuXG4gICAgICAgICAgICBsZXQgeCA9IDA7XG4gICAgICAgICAgICBsZXQgeSA9IDA7XG5cbiAgICAgICAgICAgIHNlbGYuZHJhd1JlY3QoeCwgeSwgZmllbGRTaXplLCBmaWVsZFNpemUsICcjMDA4ODMzJyk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNlbGYuTElORV9OVU1CRVI7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlbGYuZHJhd0xpbmUoeCwgMCwgeCwgZmllbGRTaXplKTtcbiAgICAgICAgICAgICAgICB4ICs9IHNlbGYuR1JJRF9TSVpFO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gc2VsZi5MSU5FX05VTUJFUjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5kcmF3TGluZSgwLCB5LCBmaWVsZFNpemUsIHkpO1xuICAgICAgICAgICAgICAgIHkgKz0gc2VsZi5HUklEX1NJWkU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBkcmF3UmVjdDogZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIGNvbG9yKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gdHlwZW9mIGNvbG9yICE9PSAndW5kZWZpbmVkJyA/IGNvbG9yIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFJlY3QoeDEsIHkxLCB4MiwgeTIpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhd0xpbmU6IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBjb2xvciwgd2lkdGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5zdHJva2VTdHlsZSA9IHR5cGVvZiBjb2xvciAhPT0gJ3VuZGVmaW5lZCcgPyBjb2xvciA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmxpbmVXaWR0aCA9IHR5cGVvZiB3aWR0aCAhPT0gJ3VuZGVmaW5lZCcgPyB3aWR0aCA6IDE7XG5cbiAgICAgICAgICAgIHNlbGYuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgc2VsZi5jdHgubW92ZVRvKHgxLCB5MSk7XG4gICAgICAgICAgICBzZWxmLmN0eC5saW5lVG8oeDIsIHkyKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgICAgICBzZWxmLmN0eC5zdHJva2UoKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIHN0YXJ0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgY29uc3QgY2VudGVyID0gc2VsZi5HUklEX1NJWkUgKiAoKHNlbGYuTElORV9OVU1CRVIgLSAxKSAvIDIpO1xuICAgICAgICAgICAgY29uc3QgZGlmZiA9IChzZWxmLkdSSURfU0laRSAvIDIpO1xuICAgICAgICAgICAgbGV0IGRpcjEgPSAtMTtcbiAgICAgICAgICAgIGxldCBkaXIyID0gLTE7XG4gICAgICAgICAgICBsZXQgcG9zWCwgcG9zWTtcbiAgICAgICAgICAgIGxldCBpc1doaXRlID0gMTtcblxuICAgICAgICAgICAgc2V0Rmlyc3RTdG9uZSgpO1xuICAgICAgICAgICAgZGlyMSAqPSAtMTtcbiAgICAgICAgICAgIGlzV2hpdGUgKj0gLTE7XG4gICAgICAgICAgICBzZXRGaXJzdFN0b25lKCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEZpcnN0U3RvbmUoY29sb3IpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHI6IHNlbGYuUlxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHBvc1ggPSBjZW50ZXIgKyBkaXIxICogZGlmZjtcbiAgICAgICAgICAgICAgICAgICAgcG9zWSA9IGNlbnRlciArIGRpcjIgKiBkaWZmO1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEueCA9IHBvc1g7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEueSA9IHBvc1k7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNXaGl0ZSA9IGlzV2hpdGU7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0b25lID0gbmV3IHdpbmRvdy5teU90aGVsbG8uU3RvbmUoc2VsZi5jdHgsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBzdG9uZS5kcmF3QXJjKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBvYmogPSBzZWxmLmJvYXJkW01hdGguZmxvb3IocG9zWSAvIHNlbGYuR1JJRF9TSVpFKV1bTWF0aC5mbG9vcihwb3NYIC8gc2VsZi5HUklEX1NJWkUpXTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmluc3RhbmNlID0gc3RvbmU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5pc1doaXRlID0gaXNXaGl0ZTtcblxuICAgICAgICAgICAgICAgICAgICBkaXIxICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICBkaXIyICo9IC0xO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoIXNlbGYuY2F1dGlvblRleHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpc1Zpc2libGUnKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2F1dGlvblRleHQuY2xhc3NMaXN0LmFkZCgnaXNWaXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYXV0aW9uVGV4dC5jbGFzc0xpc3QucmVtb3ZlKCdpc1Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHB1dFN0b25lOiBmdW5jdGlvbihjbGlja2VkWCwgY2xpY2tlZFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICBsZXQgbnRoR3JpZFggPSBNYXRoLmZsb29yKGNsaWNrZWRYIC8gc2VsZi5HUklEX1NJWkUpO1xuICAgICAgICAgICAgbGV0IG50aEdyaWRZID0gTWF0aC5mbG9vcihjbGlja2VkWSAvIHNlbGYuR1JJRF9TSVpFKTtcblxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrVmFjYW5jeShudGhHcmlkWCwgbnRoR3JpZFkpKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzZWxmLmNoZWNrTmVpZ2hib3IobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc2VsZi5jaGVja0lmUG9zc2libGUobnRoR3JpZFgsIG50aEdyaWRZKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgY29sb3IgPSBzZWxmLmlzV2hpdGUgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB4OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWCkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICB5OiAoc2VsZi5HUklEX1NJWkUgKiBudGhHcmlkWSkgKyAoc2VsZi5HUklEX1NJWkUgLyAyKSxcbiAgICAgICAgICAgICAgICByOiBzZWxmLlIsXG4gICAgICAgICAgICAgICAgaXNXaGl0ZTogc2VsZi5pc1doaXRlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgc3RvbmUgPSBuZXcgd2luZG93Lm15T3RoZWxsby5TdG9uZShzZWxmLmN0eCwgZGF0YSk7XG4gICAgICAgICAgICBzdG9uZS5kcmF3QXJjKGRhdGEpO1xuXG4gICAgICAgICAgICBsZXQgb2JqID0gc2VsZi5ib2FyZFtudGhHcmlkWV1bbnRoR3JpZFhdO1xuICAgICAgICAgICAgb2JqLmluc3RhbmNlID0gc3RvbmU7XG4gICAgICAgICAgICBvYmouaXNXaGl0ZSA9IHNlbGYuaXNXaGl0ZTtcblxuICAgICAgICAgICAgaWYgKHNlbGYudHVyblN0b25lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmZvckVhY2goZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbC5pc1doaXRlICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB2YWwuaW5zdGFuY2UucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja1ZhY2FuY3k6IGZ1bmN0aW9uKG50aFgsIG50aFkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoc2VsZi5ib2FyZFtudGhZXVtudGhYXSkubGVuZ3RoIDw9IDA7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja05laWdoYm9yOiBmdW5jdGlvbihudGhYLCBudGhZKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgbGV0IHJvdywgbGluZTtcblxuICAgICAgICAgICAgbGV0IG5laWdoYm9ycyA9IFtcbiAgICAgICAgICAgICAgICBbbnRoWCwgbnRoWSAtIDFdLCAgICAgICAvLyDkuIpcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFkgLSAxXSwgICAvLyDlj7PkuIpcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFldLCAgICAgICAvLyDlj7NcbiAgICAgICAgICAgICAgICBbbnRoWCArIDEsIG50aFkgKyAxXSwgICAvLyDlj7PkuItcbiAgICAgICAgICAgICAgICBbbnRoWCwgbnRoWSArIDFdLCAgICAgICAvLyDkuItcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFkgKyAxXSwgICAvLyDlt6bkuItcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFldLCAgICAgICAvLyDlt6ZcbiAgICAgICAgICAgICAgICBbbnRoWCAtIDEsIG50aFkgLSAxXSAgICAvLyDlt6bkuIpcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBuZWlnaGJvcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIGxpbmUgPSBuZWlnaGJvcnNbaV1bMV07XG4gICAgICAgICAgICAgICAgcm93ID0gbmVpZ2hib3JzW2ldWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGxpbmUgPCAwIHx8IGxpbmUgPiA3IHx8IHJvdyA8IDAgfHwgcm93ID4gNykge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoc2VsZi5ib2FyZFtsaW5lXVtyb3ddKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrSWZQb3NzaWJsZTogZnVuY3Rpb24obnRoWCwgbnRoWSkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coaSArICcgLyA0Jyk7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coTWF0aC5jb3MoTWF0aC5QSSAvIDQgKiBpKSwgTWF0aC5zaW4oTWF0aC5QSSAvIDQgKiBpKSk7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIGNvbnN0IE1BWF9DT1VOVCA9IChzZWxmLkxJTkVfTlVNQkVSIC0gMSkgLSAxOyAvLyAoKOe3muOBruaVsC0xKSAtIOiHqui6q+OBjOe9ruOBi+OCjOOCi+ODnuOCuSlcbiAgICAgICAgICAgIGxldCBpc1Bvc3NpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNUbXBQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IG9iaiA9IG51bGw7XG4gICAgICAgICAgICBsZXQgdG1wT2JqID0gbnVsbDtcbiAgICAgICAgICAgIGxldCB0bXBUdXJuU3RvbmVzID0gW107XG5cbiAgICAgICAgICAgIC8vIOe9ruOBkeOCi+adoeS7tlxuICAgICAgICAgICAgLy8g5bem5Y+z44CB5LiK5LiL44CB5pac44KBNDXluqbkuIrjgavlkIzjgZjoibLjga7nn7PjgYzjgYLjgotcbiAgICAgICAgICAgIC8vIOOBi+OBpCDjgZ3jga7lkIzjgZjoibLjga7nn7Pjgajoh6rouqvjga7plpPjgavpmpnplpPjgarjgY/liKXjga7oibLjga7nn7PjgYzjgYLjgotcblxuICAgICAgICAgICAgLy8gbGV0IG5laWdoYm9ycyA9IFtcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCwgbnRoWSAtIDFdLCAgICAgICAvLyDkuIpcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCArIDEsIG50aFkgLSAxXSwgICAvLyDlj7PkuIpcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCArIDEsIG50aFldLCAgICAgICAvLyDlj7NcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCArIDEsIG50aFkgKyAxXSwgICAvLyDlj7PkuItcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCwgbnRoWSArIDFdLCAgICAgICAvLyDkuItcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCAtIDEsIG50aFkgKyAxXSwgICAvLyDlt6bkuItcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCAtIDEsIG50aFldLCAgICAgICAvLyDlt6ZcbiAgICAgICAgICAgIC8vICAgICBbbnRoWCAtIDEsIG50aFkgLSAxXSAgICAvLyDlt6bkuIpcbiAgICAgICAgICAgIC8vIF07XG4gICAgICAgICAgICAvLyDjgafjgZ3jgozjgZ7jgozjg4Hjgqfjg4Pjgq/jgZnjgovvvJ9cbiAgICAgICAgICAgIGNoZWNrVG9wKCk7XG4gICAgICAgICAgICBjaGVja0JvdHRvbSgpO1xuXG5cbiAgICAgICAgICAgIHJldHVybiBpc1Bvc3NpYmxlO1xuXG5cbiAgICAgICAgICAgIC8vIOS4iuOCkuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tUb3AoKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFkgLSBpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyDoh6rouqvjgYvjgonoqbLlvZPmlrnlkJHjga7kuK3jgafkuIDnlarov5HjgYTnn7NcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gc2VsZi5ib2FyZFtudGhZIC0gaV1bbnRoWF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA+IDApICYmIChvYmouaXNXaGl0ZSAqIC0xID09PSBzZWxmLmlzV2hpdGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqID0gc2VsZi5ib2FyZFtudGhZIC0gal1bbnRoWF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wT2JqLnkgPSBudGhZIC0gajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueCA9IG50aFg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModG1wT2JqKS5sZW5ndGggPiAwICYmIHRtcE9iai5pc1doaXRlID09PSBzZWxmLmlzV2hpdGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RtcFBvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5wdXNoKHRtcE9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wVHVyblN0b25lcy5sZW5ndGggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVG1wUG9zc2libGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSB0bXBUdXJuU3RvbmVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHVyblN0b25lcy5wdXNoKHRtcFR1cm5TdG9uZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQb3NzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIOS4i+OCkuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tCb3R0b20oKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1BWF9DT1VOVDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG50aFkgKyBpID4gNykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvYmogPSBzZWxmLmJvYXJkW250aFkgKyBpXVtudGhYXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID4gMCkgJiYgKG9iai5pc1doaXRlICogLTEgPT09IHNlbGYuaXNXaGl0ZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmogPSBzZWxmLmJvYXJkW250aFkgKyBqXVtudGhYXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBPYmoueSA9IG50aFkgKyBqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9iai54ID0gbnRoWDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0bXBPYmopLmxlbmd0aCA+IDAgJiYgdG1wT2JqLmlzV2hpdGUgPT09IHNlbGYuaXNXaGl0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVG1wUG9zc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLnB1c2godG1wT2JqKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUbXBQb3NzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBUdXJuU3RvbmVzLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUbXBQb3NzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IHRtcFR1cm5TdG9uZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50dXJuU3RvbmVzLnB1c2godG1wVHVyblN0b25lc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcFR1cm5TdG9uZXMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Bvc3NpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuXG5cblxuXG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93Lm15T3RoZWxsbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgd2luZG93Lm15T3RoZWxsbyA9IHt9O1xuICAgIH1cbiAgICB3aW5kb3cubXlPdGhlbGxvLkJvYXJkTWFuYWdlciA9IEJvYXJkTWFuYWdlcjtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgUGxheWVyID0gZnVuY3Rpb24oY2FudmFzLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuY2FudmFzID0gY2FudmFzO1xuXG4gICAgICAgIHNlbGYuY29sb3IgPSBkYXRhLmNvbG9yO1xuICAgICAgICBzZWxmLnN0b25lcyA9IFtdO1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH07XG5cbiAgICBQbGF5ZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHNlbGYuc2V0RXZlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gc2VsZi5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coZS5vZmZzZXRYKTtcbiAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Q2xpY2tQb3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uUGxheWVyID0gUGxheWVyO1xuXG59KCkpOyIsIjsoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBTdG9uZSA9IGZ1bmN0aW9uKGN0eCwgZGF0YSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmN0eCA9IGN0eDtcbiAgICAgICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICAgICAgc2VsZi5pc1doaXRlID0gZGF0YS5pc1doaXRlO1xuXG4gICAgfTtcblxuICAgIFN0b25lLnByb3RvdHlwZSA9IHtcblxuICAgICAgICBkcmF3QXJjOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5hcmMoZGF0YS54LCBkYXRhLnksIGRhdGEuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gc2VsZi5pc1doaXRlID4gMCA/ICcjZmZmZmZmJyA6ICcjMDAwMDAwJztcbiAgICAgICAgICAgIHNlbGYuY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIHNlbGYuY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV2ZXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBzZWxmLmN0eC5hcmMoc2VsZi5kYXRhLngsIHNlbGYuZGF0YS55LCBzZWxmLmRhdGEuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbFN0eWxlID0gc2VsZi5pc1doaXRlICogLTEgPiAwID8gJyNmZmZmZmYnIDogJyMwMDAwMDAnO1xuICAgICAgICAgICAgc2VsZi5jdHguZmlsbCgpO1xuICAgICAgICAgICAgc2VsZi5jdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cubXlPdGhlbGxvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cubXlPdGhlbGxvID0ge307XG4gICAgfVxuICAgIHdpbmRvdy5teU90aGVsbG8uU3RvbmUgPSBTdG9uZTtcblxufSgpKTsiLCI7KGZ1bmN0aW9uKCkge1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcblxuICAgICAgICBpZiAoIWNhbnZhcy5nZXRDb250ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXBwZXInKTtcbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGN0eC5jYW52YXMud2lkdGggPSB3cmFwcGVyLmNsaWVudFdpZHRoO1xuICAgICAgICBjdHguY2FudmFzLmhlaWdodCA9IHdyYXBwZXIuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgIGxldCBwbGF5ZXJEYXRhID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdibGFjaydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgYm9hcmQgPSBuZXcgbXlPdGhlbGxvLkJvYXJkTWFuYWdlcihjdHgpO1xuXG4gICAgICAgIGJvYXJkLnN0YXJ0R2FtZSgpO1xuXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgYm9hcmQucHV0U3RvbmUoZS5vZmZzZXRYLCBlLm9mZnNldFkpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIOODleOCo+ODvOODq+ODieOCkuabuOOBj++8iDh4OO+8iVxuICAgICAgICAvLyDlkITjg57jgrnnm67jga7jgqjjg6rjgqLmg4XloLHjgpLkv53mjIHvvIhzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWe+8iVxuICAgICAgICAvLyAgICAgIOOCr+ODquODg+OCr+OBl+OBn+S9jee9ruOBqGNhbnZhc+S4iuOBruS9jee9ruOBruWkieaPm+OBjOW/heimge+8n1xuICAgICAgICAvLyDjg5fjg6zjgqTjg6Tjg7znmb3jg7vpu5LjgpLjgrvjg4Pjg4hcbiAgICAgICAgLy8gICAgICDjg5Xjg6njgrDjgavjgZnjgovvvJ9cbiAgICAgICAgLy8g5Lit5aSu44Gr55m96buSMuOBk+OBmuOBpOOCu+ODg+ODiFxuXG4gICAgICAgIC8vIOWQhOODl+ODrOOCpOODpOODvOOBrue9ruOBhOOBn+efs+OCkuS/neaMgeOBmeOCi+mFjeWIl1xuICAgICAgICAvL1xuXG5cblxuICAgIH0pO1xuXG59KCkpO1xuXG4vKipcbiAqIC8vIFRPRE8g6LOq5ZWPXG4gKlxuICogMS5cbiDjgIzliKTlrprjgZnjgovjgI3jgajjgYTjgYboi7Hoqp7jga/kvZXjgpLkvb/jgaPjgabjgb7jgZnjgYvvvJ9cblxuIGZpbmQ/IGp1ZGdlPyBkZWNpZGU/XG5cblxuIDIuXG4gY2hyb21l44GuZGV244OE44O844Or44Gn44Kk44Oz44K544K/44Oz44K544Gr5YWl44Gj44Gm44GE44KLdOOBqOOBr+OBquOCk+OBruaEj+WRs+OAgeeVpe+8iO+8n++8ieOBp+OBmeOBi++8n+OCpOODs+OCueOCv+ODs+OCueOCkuODreOCsOOBq+WHuuOBmeOBqHTjgajjgarjgovvvJ9cbiBib2FyZC5zdGFydEdhbWXjga7mnIDlvozjgadjb25zb2xlLmxvZyhzZWxmLnN0b25lUG9zZXMpO+OBmeOCi+OBqOeiuuiqjeOBp+OBjeOCi1xuXG4gKi9cbiJdfQ==